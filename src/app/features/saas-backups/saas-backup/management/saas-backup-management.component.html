<ng-container *ngIf="selectedSaasBackup$ | async as selectedSaasBackup">
  <mcs-presentation-panel mcsId="saas-backup-schedule">
    <!-- Schedule -->
    <ng-container mcsPresentationPanelHeader>
      <h2>{{ 'saasBackup.schedule.description' | translate }}</h2>
    </ng-container>

    <mcs-item>
      <span>{{ 'saasBackup.schedule.dailySchedule' | translate }}:</span>
      <span [innerHTML]="selectedSaasBackup.dailySchedule | mcsDataLabel: 'Unknown'"></span>
    </mcs-item>
    <br/>
  </mcs-presentation-panel>

  <mcs-presentation-panel mcsId="saas-backup-backup-attempts">
    <!-- Backup Attempts -->
    <ng-container mcsPresentationPanelHeader>
      <h2>{{ 'saasBackup.backupAttempts.description' | translate }}</h2>
    </ng-container>

    <mcs-item class="item-wrapper item-inline">
      <span padding-right-xsmall>{{ 'saasBackup.backupAttempts.lastAttempt' | translate }}:</span>
      <ng-container *ngIf="lastBackupAttempt; else loadingTemplate">
        <ng-container *ngIf="!hasActiveJob; else runningTemplate">
          <mcs-item>
            <mcs-icon
              [key]="lastBackupAttempt.backupGeneralStatusStateIconKey" size="small"></mcs-icon>
            <div>
              <span [innerHTML]="lastBackupAttempt?.generalStatusLabel"></span>
              <span *ngIf="lastBackupAttempt.runTime"> ({{ lastBackupAttempt.runTime | mcsStdDateFormat: 'DD/MM/YYYY, h:mm A' }})</span>
              <small>
                <mcs-item>
                  <span>{{ 'saasBackup.backupAttempts.emailBackupAttempt' | translate }}</span>
                </mcs-item>
              </small>
            </div>
          </mcs-item>
        </ng-container>
        <ng-template #runningTemplate>
          Running  <mat-spinner class="spinner" diameter="20" matSuffix></mat-spinner>
        </ng-template>
      </ng-container>
      <ng-template #loadingTemplate>
        <mcs-loader size="small"></mcs-loader>
      </ng-template>
    </mcs-item>
    <br/>
    <ng-container *mcsAccessControl="['SaasBackupEdit']">
      <!-- Attempt Backup -->
      <a *ngIf="lastBackupAttempt"
        (click)="attemptSaasBackup(selectedSaasBackup.id)"
        [disabled]="hasActiveJob">
        <ng-container *ngIf="lastBackupAttempt?.generalStatus; else reattemptTemplate">
          {{ 'action.reattemptBackup' | translate }}
        </ng-container>
        <ng-template #reattemptTemplate>
          {{ 'action.attemptBackup' | translate }}
        </ng-template>
      </a>
    </ng-container>
  </mcs-presentation-panel>

  <mcs-presentation-panel mcsId="saas-backup-user-protection-history">
    <!-- Schedule -->
    <ng-container mcsPresentationPanelHeader>
      <h2>{{ 'saasBackup.backupHistory.description' | translate }}</h2>
    </ng-container>
    <span>{{ 'saasBackup.backupHistory.label' | translate }}</span>
    <table mat-table [dataSource]="dataSource">
      
      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'columnHeader.date' | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          <ng-container *ngIf="row.startTime | mcsIsNotNullOrEmpty; else emptyDateTemplate">
            {{ row.startTime | mcsStdDateFormat: 'weekFriendly'  }}
          </ng-container>
          <ng-template #emptyDateTemplate>
            <span>{{ 'label.none' | translate }}</span>
          </ng-template>
        </td>
      </ng-container>

      <!-- Protected Users Column -->
      <ng-container matColumnDef="protectedUsers">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'columnHeader.protectedUsers' | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row.protectedUsers }}
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'columnHeader.status' | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          <mcs-icon [key]="row.backupGeneralStatusStateIconKey" size="small"></mcs-icon>
          {{ row.generalStatusLabel }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="dataSource?.dataColumns$ | async"></tr>
      <tr mat-row *matRowDef="let row; columns: dataSource?.dataColumns$ | async;"></tr>
    </table>

    <!-- Table Statuses -->
    <mcs-item orientation="block">
      <div *ngIf="dataSource?.isInProgress$ | async" align="center">
        <mcs-loader size="medium"></mcs-loader>
      </div>
      <div *ngIf="dataSource?.hasNoRecords$ | async" text-center>
        <span>{{ 'saasBackup.backupAttempts.noData' | translate }} </span>
      </div>
      <div *ngIf="dataSource?.hasError$ | async" text-center>
        <div class="listing-status-wrapper">
          <span>{{ 'saasBackup.backupAttempts.errorMessage' | translate }}</span>
          <a (click)="retryDatasource()"
            mcsId
            mcsEventTracker="retry-saas-backup"
            mcsEventCategory="storage"
            mcsEventLabel="saas-backup-backup-attempt-listing-page">{{ 'action.tryAgainShortly' | translate }}</a>.
        </div>
      </div>
    </mcs-item>
  </mcs-presentation-panel>
</ng-container>
