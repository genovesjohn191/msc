<mcs-page [header]="textContent.header">
  <!-- Top Panel -->
  <mcs-top-panel *mcsTopPanelDef>
    <!-- Server Creation -->
    <mcs-top-panel-item *mcsTopPanelItemDef>
      <mcs-action-item class="right-align" (click)="gotoTickets()">
        <mcs-icon [key]="backIconKey" size="large"></mcs-icon>
        <span>{{ textContent.backToTickets }}</span>
      </mcs-action-item>
    </mcs-top-panel-item>
  </mcs-top-panel>

  <!-- Content Panel -->
  <mcs-content-panel *mcsContentPanelDef>
    <div class="contextual-help-page-wrapper">
      <!-- Create ticket details -->
      <div class="page-information-wrapper ticket-create-information limited-view">
        <p [innerHTML]="textContent.description"></p>

        <form [formGroup]="fgCreateTicket" mcsFormGroup class="create-ticket-form">

          <!-- Ticket Type -->
          <div class="field">
            <mcs-form-field>
              <mcs-select id="type" [placeholder]="textContent.placeholders.type"
                [formControl]="fcType" set-focus required
                [mcsContextualHelp]="contextualContent.type">
                <mcs-select-item>--</mcs-select-item>
                <mcs-select-group header="Ticket Type">
                  <mcs-select-item *ngFor="let ticketType of ticketTypeList"
                    [value]="ticketType.value">
                    {{ ticketType.text }}
                  </mcs-select-item>
                </mcs-select-group>
              </mcs-select>

              <mcs-error mcsError errorState="required">
                {{ textContent.errors.typeRequired }}
              </mcs-error>
            </mcs-form-field>
          </div>


          <!-- Headline -->
          <div class="field">
            <mcs-form-field>
              <input mcsInput #headlineInput required
                [placeholder]="textContent.placeholders.headline" maxlength="80"
                [formControl]="fcHeadline"
                [mcsContextualHelp]="contextualContent.headline">

                <mcs-hint mcsHint align="start">
                  {{ convertMaxCharText(textContent.hints.headline, headlineInput.maxLength) }}
                </mcs-hint>
                <mcs-hint mcsHint align="end">
                  {{ headlineInput.value.length }} / {{ headlineInput.maxLength }}
                </mcs-hint>
                <mcs-error mcsError errorState="required">
                  {{ textContent.errors.headlineRequired }}
                </mcs-error>
            </mcs-form-field>
          </div>

          <!-- Details -->
          <div class="field">
            <mcs-form-field>
              <textarea mcsInput rows="3" #detailsInput required
                [placeholder]="textContent.placeholders.details" maxlength="4000"
                [formControl]="fcDetails"
                [mcsContextualHelp]="contextualContent.details"></textarea>

              <mcs-hint mcsHint align="start">
                {{ convertMaxCharText(textContent.hints.details, detailsInput.maxLength) }}
              </mcs-hint>
              <mcs-hint mcsHint align="end">
                {{ detailsInput.value.length }} / {{ detailsInput.maxLength }}
              </mcs-hint>
              <mcs-error mcsError errorState="required">
                {{ textContent.errors.detailsRequired }}
              </mcs-error>
            </mcs-form-field>
          </div>

          <!-- Services -->
          <div class="field">
            <label class="label" for="services">{{ textContent.services }}</label>
            <div class="item">
              <ng-container *ngIf="services">

                <div display-flex="row" align-items="flex-start">
                  <!-- Tags -->
                  <mcs-form-field flex="auto">
                    <mcs-tag-list [placeholder]="textContent.placeholders.services"
                      [formControl]="fcService" required>

                      <mcs-tag *ngFor="let subItem of selectService.selectionSubModel.selected"
                        [selectable]="true" [removable]="true"
                        (removed)="selectService.removeSubSelection(subItem)">
                        {{ subItem.text }}
                      </mcs-tag>
                    </mcs-tag-list>

                    <mcs-error mcsError errorState="required">
                      {{ textContent.errors.servicesRequired }}
                    </mcs-error>
                  </mcs-form-field>

                  <!-- Icon trigger -->
                  <div cursor="pointer" id="ctaSelectService"
                    class="space-left-small space-top-small" flex="none"
                    (click)="servicePanelOpen = !servicePanelOpen" #trigger>
                    <mcs-icon [key]="toggleIconKey"></mcs-icon>
                    <mcs-ripple class="icon-ripple-wrapper"
                      mcsRipple
                      [rippleTrigger]="trigger"
                      [rippleCentered]="true">
                    </mcs-ripple>
                  </div>
                </div>

                <mcs-select-tag #selectService [hidden]="!servicePanelOpen" class="vspace-small"
                  (selectionChanged)="serviceItemSelectionChanged($event)">
                  <mcs-select-tag-main-item *ngFor="let service of services"
                    [header]="service.serviceName">

                    <mcs-select-tag-sub-item *ngFor="let item of service.serviceItems"
                      [searchKey]="item.name" [value]="item.serviceId">
                      {{ item.name }}
                    </mcs-select-tag-sub-item>
                  </mcs-select-tag-main-item>
                </mcs-select-tag>
              </ng-container>
            </div>
          </div>

          <!-- Attachments -->
          <div class="field">
            <h4>{{ textContent.attachments }}</h4>
            <mcs-attachment attachedLimit="multiple"
              [allowedMimeType]="['image/jpeg', 'image/png', 'image/bmp', 'text/plain']"
              (attachedFilesChanged)="onChangedAttachments($event)"
              [mcsContextualHelp]="contextualContent.attachments">
            </mcs-attachment>
          </div>

          <!-- Ticket Action -->
          <div class="basic-action-bar">
            <a (click)="gotoTickets()">{{ textContent.cancelActivity }}</a>

            <button mcsButton id="ctaNewTicket" arrow="right"
              (click)="onLogTicket()" [mcsLoader]="createTicketSubscription">
              {{ textContent.newTicket }}
            </button>
          </div>
        </form>
      </div>

      <!-- Create ticket contextual help -->
      <div class="contextual-information-wrapper">
        <mcs-contextual-help
          [contextualInformations]="contextualHelp"></mcs-contextual-help>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>