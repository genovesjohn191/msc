<mcs-page [header]="ticketHeader" [mcsLoader]="ticketSubscription">
  <!-- Top Panel -->
  <ng-container *ngIf="ticketResolved">
    <mcs-top-panel *mcsTopPanelDef>

      <!-- Ticket Status -->
      <mcs-top-panel-item *mcsTopPanelItemDef>
        <div flex="auto" display-flex align-items="center" justify-content="flex-end">
          <mcs-icon [key]="checkIconKey" size="large"></mcs-icon>
          <span>
            {{ getStateString(ticket.state) }} ({{ convertDateToString(ticket.createdOn) }})
          </span>
        </div>
      </mcs-top-panel-item>
    </mcs-top-panel>
  </ng-container>

  <!-- Content Panel -->
  <mcs-content-panel *mcsContentPanelDef>
    <div class="content-wrapper limited-view">
      <!-- Ticket Content -->
      <div class="ticket-info-wrapper">
        <h4>{{ ticket.shortDescription }}</h4>
        <span class="metadata">{{ getSubTypeString(ticket.subType) }}</span>
        <p>
          <span>{{ requestor }}</span>
          <span>{{ convertDateToString(ticket.createdOn) }}</span>
        </p>
        <p>{{ ticket.description }}</p>
      </div>

      <!-- Ticket Meta Data -->
      <div class="ticket-meta-wrapper hidden-small">
        <div class="ticket-info-wrapper">
          <h4>{{ textContent.services }}</h4>
          <span *ngIf="missingServices" class="missing-data-info">{{ textContent.missingServicesLabel }}</span>
          <ul class="unstyled-list">
            <li *ngFor="let service of ticket.serviceId; trackBy: trackByFn">
              {{ service }}
            </li>
          </ul>
        </div>

        <!-- Ticket Attachments -->
        <div class="ticket-info-wrapper">
          <h4>{{ textContent.attachments }}</h4>
          <span *ngIf="missingAttachments" class="missing-data-info">{{ textContent.missingAttachmentsLabel }}</span>
          <ul class="unstyled-list">
            <li *ngFor="let attachment of ticket.attachments; trackBy: trackByFn">
              <mcs-icon [key]="attachmentIconKey" size="small"></mcs-icon>
              <a (click)="downloadAttachment(attachment)">{{ attachment.fileName }}</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Ticket Activities -->
      <div class="ticket-info-wrapper">
        <div class="ticket-activities-header">
          <h4>{{ textContent.activity }}</h4>
          <div class="create-new-comment-wrapper">
            <ng-container [mcsLoader]="[createCommentSubscription, createAttachmentSubscription]">
            </ng-container>
            <mcs-button size="small" (click)="newComment()">New Comment/Attachment</mcs-button>
          </div>
        </div>
        <ng-container *ngIf="showCommentBox">
          <mcs-ticket-new-comment
            (onCancelComment)="cancelComment($event)"
            (onCreateComment)="createComment($event)">
          </mcs-ticket-new-comment>
        </ng-container>
        <span *ngIf="missingActivities" class="missing-data-info">{{ textContent.missingActivitiesLabel }}</span>
        <mcs-ticket-activity *ngFor="let activity of activities; trackBy: trackByFn"
          [activity]="activity">
        </mcs-ticket-activity>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>