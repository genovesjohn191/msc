<mcs-page [header]="ticketHeader" [mcsLoader]="ticketSubscription">
  <!-- Top Panel -->
  <mcs-top-panel *mcsTopPanelDef>

    <!-- Ticket Status -->
    <ng-container *ngIf="ticketResolved">
      <mcs-top-panel-item *mcsTopPanelItemDef>
        <div flex="auto" display-flex align-items="center" justify-content="flex-end">
          <mcs-icon [key]="checkIconKey" size="large"></mcs-icon>
          <span>
            {{ getStateString(ticket.state) }} ({{ convertDateToString(ticket.createdOn) }})
          </span>
        </div>
      </mcs-top-panel-item>
    </ng-container>

    <!-- Back to Tickets -->
    <mcs-top-panel-item *mcsTopPanelItemDef>
      <mcs-action-item class="right-align" (click)="gotoTickets()">
        <mcs-icon [key]="backIconKey" size="large"></mcs-icon>
        <span>{{ textContent.backToTickets }}</span>
      </mcs-action-item>
    </mcs-top-panel-item>
  </mcs-top-panel>

  <!-- Content Panel -->
  <mcs-content-panel *mcsContentPanelDef>
    <div class="limited-view block-items-large">
      <!-- Ticket Content -->
      <div class="block-items-medium">
        <div display-flex="row" justify-content="space-between">
          <h4>{{ ticket.shortDescription }}</h4>
          <span class="metadata">{{ getSubTypeString(ticket.subType) }}</span>
        </div>
        <p>
          <span>{{ requestor }}</span>
          <span>{{ convertDateToString(ticket.createdOn) }}</span>
        </p>
        <p>{{ ticket.description }}</p>
      </div>

      <!-- Ticket Status -->
      <div class="hidden-small" display-flex="row">
        <div flex="equal">
          <h4>{{ textContent.status }}</h4>
          <span>{{ getStateString(ticket.state) }}</span>
        </div>
      </div>

      <!-- Ticket Meta Data -->
      <div class="hidden-small" display-flex="row">
        <div flex="equal">
          <h4>{{ textContent.services }}</h4>
          <span *ngIf="missingServices" class="missing-data-info">
            {{ textContent.missingServicesLabel }}
          </span>
          <ul class="inline-list">
            <li *ngFor="let service of ticket.serviceId; trackBy: trackByFn">
              {{ service }}
            </li>
          </ul>
        </div>

        <!-- Ticket Attachments -->
        <div flex="equal">
          <h4>{{ textContent.attachments }}</h4>
          <span *ngIf="missingAttachments" class="missing-data-info">
            {{ textContent.missingAttachmentsLabel }}
          </span>
          <ul class="inline-list rollover">
            <li *ngFor="let attachment of ticket.attachments; trackBy: trackByFn">
              <mcs-icon [key]="attachmentIconKey" size="small"></mcs-icon>
              <a (click)="downloadAttachment(attachment)">{{ attachment.fileName }}</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Ticket Activities -->
      <div display-flex="column" class="vertical-items-spacing-medium">
        <div display-flex="row">
          <div flex="equal">
            <h4>{{ textContent.activity }}</h4>
            <span *ngIf="missingActivities" class="missing-data-info">
              {{ textContent.missingActivitiesLabel }}
            </span>
          </div>
          <!-- <div flex="equal"> -->
            <!-- <a (click)="newComment()"
              [hidden]="showCommentBox">{{ textContent.newActivity }}</a>
          </div> -->
        </div>

        <div class="position-relative">
          <div [mcsLoader]="[createCommentSubscription, createAttachmentSubscription]"
            [mcsLoaderHideElement]="commentBox"
            [mcsLoaderPreserveHeight]="true"
            [mcsLoaderText]="textContent.creatingComment">
          </div>
          <div #commentBox>
            <mcs-comment-box attachedLimit="single"
              [allowedMimeType]="['image/jpeg', 'image/png', 'image/bmp', 'text/plain']"
              (onAddComment)="createComment($event)">
            </mcs-comment-box>
          </div>
        </div>

        <mcs-ticket-activity [ticketId]="ticket.id"
          *ngFor="let activity of activities; trackBy: trackByFn"
          [activity]="activity">
        </mcs-ticket-activity>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>