<mcs-page [header]="ticketHeader" [mcsLoader]="ticketSubscription">
  <!-- Top Panel -->
  <mcs-top-panel *mcsTopPanelDef>

    <!-- Ticket Status -->
    <ng-container *ngIf="ticketResolved">
      <mcs-top-panel-item *mcsTopPanelItemDef>
        <div flex="auto" display-flex align-items="center" justify-content="flex-end">
          <mcs-icon [key]="checkIconKey" size="large"></mcs-icon>
          <span>
            {{ getStateString(ticket.state) }} ({{ convertDateToString(ticket.createdOn) }})
          </span>
        </div>
      </mcs-top-panel-item>
    </ng-container>

    <!-- Back to Tickets -->
    <mcs-top-panel-item *mcsTopPanelItemDef>
      <mcs-action-item class="right-align" (click)="gotoTickets()">
        <mcs-icon [key]="backIconKey" size="large"></mcs-icon>
        <span>{{ textContent.backToTickets }}</span>
      </mcs-action-item>
    </mcs-top-panel-item>
  </mcs-top-panel>

  <!-- Content Panel -->
  <mcs-content-panel *mcsContentPanelDef>
    <div class="content-wrapper limited-view">
      <!-- Ticket Content -->
      <div>
        <h4>{{ ticket.shortDescription }}</h4>
        <span class="metadata">{{ getSubTypeString(ticket.subType) }}</span>
        <p>
          <span>{{ requestor }}</span>
          <span>{{ convertDateToString(ticket.createdOn) }}</span>
        </p>
        <p>{{ ticket.description }}</p>
      </div>

      <!-- Ticket Meta Data -->
      <div class="hidden-small horizontal-items-spacing-medium" display-flex="row">
        <div>
          <h4>{{ textContent.services }}</h4>
          <span *ngIf="missingServices" class="missing-data-info">{{ textContent.missingServicesLabel }}</span>
          <ul class="inline-list">
            <li *ngFor="let service of ticket.serviceId; trackBy: trackByFn">
              {{ service }}
            </li>
          </ul>
        </div>

        <!-- Ticket Attachments -->
        <div>
          <h4>{{ textContent.attachments }}</h4>
          <span *ngIf="missingAttachments" class="missing-data-info">{{ textContent.missingAttachmentsLabel }}</span>
          <ul class="inline-list rollover">
            <li *ngFor="let attachment of ticket.attachments; trackBy: trackByFn">
              <mcs-icon [key]="attachmentIconKey" size="small"></mcs-icon>
              <a (click)="downloadAttachment(attachment)">{{ attachment.fileName }}</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Ticket Activities -->
      <div>
        <div class="vspace-large">
          <h4>{{ textContent.activity }}</h4>
          <div class="text-center">
            <ng-container [mcsLoader]="[createCommentSubscription, createAttachmentSubscription]">
            </ng-container>
            <a (click)="newComment()" [hidden]="showCommentBox">{{ textContent.newActivity }}</a>
          </div>
        </div>
        <ng-container *ngIf="showCommentBox">
          <mcs-ticket-new-comment
            (onCancelComment)="cancelComment($event)"
            (onCreateComment)="createComment($event)">
          </mcs-ticket-new-comment>
        </ng-container>
        <span *ngIf="missingActivities" class="missing-data-info">{{ textContent.missingActivitiesLabel }}</span>
        <mcs-ticket-activity [ticketId]="ticket.id" *ngFor="let activity of activities; trackBy: trackByFn"
          [activity]="activity">
        </mcs-ticket-activity>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>