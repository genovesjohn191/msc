<ng-container [ngSwitch]="serverManagementView" *ngIf="serverDetails$ | async as serverDetails">
  <!-- Management view by default -->
  <div [@fadeIn] *ngSwitchDefault>

    <mcs-grid>
      <mcs-grid-row>
        <!-- VM Properties -->
        <mcs-grid-column sizeSm="12">
          <mcs-presentation-panel mcsId="vm-properties">
            <ng-container mcsPresentationPanelHeader>
              <h2>{{ textContent.vmProperties.title }}</h2>
            </ng-container>

            <mcs-item>
              <span>{{ textContent.vmProperties.status }}:</span>
              <span [innerHTML]="serverDetails.server.statusLabel | mcsDataLabel"></span>
            </mcs-item>

            <mcs-item>
              <span>{{ textContent.vmProperties.image }}:</span>
              <span [innerHTML]="serverDetails.server.operatingSystem?.guestOs | mcsDataLabel"></span>
            </mcs-item>

            <mcs-item>
              <span>{{ textContent.vmProperties.zone }}:</span>
              <span [innerHTML]="serverDetails.server.availabilityZone | mcsDataLabel"></span>
            </mcs-item>

            <mcs-item>
              <span>{{ textContent.vmProperties.configuration }}:</span>
              <span>{{ serverDetails.server.compute?.memoryMB | mcsDataSize: 'MB' }}</span>
              <span> / </span>
              <span>{{ serverDetails.server.compute?.cpuCount | number }} vCPU</span>
              <ng-container *mcsAccessControl="['VmEdit']">
                <ng-container *ngIf="serverDetails.server.scaleable">
                  <mcs-loader *ngIf="scaleInProgress" size="small"
                    [mcsTooltip]="textContent.manageScale.scaling"></mcs-loader>
                  <a *ngIf="!scaleInProgress"
                    (click)="setViewMode(serverManagementViewEnum.ManageScale)"
                    mcsId
                    mcsEventTracker="scale-option"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page"
                    [disabled]="!serverDetails.server.executable">
                    {{ textContent.manageScale.scale }}</a>
                </ng-container>
              </ng-container>
            </mcs-item>

            <mcs-item>
              <span>{{ textContent.vmProperties.vmwareTools }}:</span>
              <ng-container *ngIf="serverDetails.server.vmwareTools?.hasTools; else vmwareTemplate">
                <span>{{ serverDetails.server.vmwareTools?.version }}</span>
              </ng-container>

              <ng-template #vmwareTemplate>
                <mcs-data-status-empty [mcsTooltip]="serversTextContent.toolsUnavailable">
                  {{ serversTextContent.toolsNotInstalled }}
                </mcs-data-status-empty>
              </ng-template>
            </mcs-item>

            <mcs-item *ngIf="serverDetails.server.vApp && !serverDetails.server.isDedicated">
              <span>{{ textContent.vmProperties.vApp }}:</span>
              <span [innerHTML]="serverDetails.server.vApp"></span>
            </mcs-item>
          </mcs-presentation-panel>
        </mcs-grid-column>

        <!-- VM Console -->
        <mcs-grid-column sizeSm="12" hidden-small
          *mcsAccessControl="[]; feature: 'enableDedicatedVmConsole';
            validateWhen: serverDetails.server.isDedicated">

          <mcs-presentation-panel mcsId="vm-console">
            <ng-container mcsPresentationPanelHeader>
              <h2>{{ textContent.vmConsole.title }}</h2>
            </ng-container>

            <ng-container *ngIf="!serverDetails.server.consoleEnabled; else consoleTemplate">
              <mcs-item orientation="block">
                <div>
                  <mcs-icon [key]="consoleIconKey" size="110px"></mcs-icon>
                </div>
                <div read-only>
                  <span *ngIf="serverDetails.server.isPoweredOff">
                    {{ textContent.vmConsole.serverPoweredOff }}
                  </span>
                  <span *ngIf="serverDetails.server.isSuspended">
                    {{ textContent.vmConsole.serverSuspended }}
                  </span>
                </div>
              </mcs-item>
            </ng-container>

            <ng-template #consoleTemplate>
              <div display-inline-block mcsCursor="pointer"
                [disabled]="serverDetails.server.isProcessing"
                (click)="viewConsole(serverDetails.server)"
                mcsId
                mcsEventTracker="view-console"
                mcsEventCategory="server"
                mcsEventLabel="server-details-page">
                <div class="image-thumbnail dark" mcsCursor="pointer">
                  <img display-block full-width [attr.src]="serverThumbnail$ | async"/>
                </div>
                <a>{{ textContent.vmConsole.link }}</a>
              </div>
            </ng-template>
          </mcs-presentation-panel>
        </mcs-grid-column>
      </mcs-grid-row>

      <mcs-grid-row>
        <!-- VM Storage -->
        <mcs-grid-column sizeSm="12">
          <mcs-presentation-panel mcsId="vm-storage">
            <ng-container mcsPresentationPanelHeader>
              <mcs-item>
                <h2>{{ textContent.storage.title }}</h2>
                <ng-container *mcsAccessControl="['VmEdit']">
                  <a *ngIf="!serverDetails.server.isDedicated"
                    [disabled]="!serverDetails.server.executable"
                    (click)="navigateServerDetailsTo(serverDetails.server, routeKeyEnum.ServerDetailStorage)"
                    mcsId
                    mcsEventTracker="manage-storage"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page">
                    {{ textContent.storage.manage }}
                  </a>
                </ng-container>
              </mcs-item>
            </ng-container>

            <ng-container *ngIf="serverDetails.server.storageDevices | mcsIsNotNullOrEmpty; else noDisks">
              <mcs-list spacing="xsmall">
                <mcs-list-item *ngFor="let storage of serverDetails.server.storageDevices">
                  <mcs-item>
                    <span>{{ storage.name }}:</span>
                    <span [innerHTML]="(storage.sizeMB | mcsDataSize: 'MB') | mcsDataLabel"></span>
                  </mcs-item>
                </mcs-list-item>
              </mcs-list>
            </ng-container>

            <ng-template #noDisks>
              <mcs-data-status-empty>
                {{ textContent.storage.noContentMessage }}
              </mcs-data-status-empty>
            </ng-template>
          </mcs-presentation-panel>
        </mcs-grid-column>

        <!-- VM NICs -->
        <mcs-grid-column sizeSm="12">
          <mcs-presentation-panel mcsId="vm-nics">
            <ng-container mcsPresentationPanelHeader>
              <mcs-item>
                <h2>{{ textContent.nics.title }}</h2>
                <ng-container *mcsAccessControl="['VmNicEdit']">
                  <a *ngIf="!serverDetails.server.isDedicated"
                    [disabled]="!serverDetails.server.executable"
                    (click)="navigateServerDetailsTo(serverDetails.server, routeKeyEnum.ServerDetailNics)"
                    mcsId
                    mcsEventTracker="manage-nics"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page">
                    {{ textContent.nics.manage }}
                  </a>
                </ng-container>
              </mcs-item>
            </ng-container>

            <ng-container *ngIf="serverDetails.server.nics | mcsIsNotNullOrEmpty; else noContentMessage">
              <mcs-accordion [multi]="true">
                <mcs-accordion-panel *ngFor="let nic of serverDetails.server.nics; let i = index"
                  [expanded]="i === 0">
                  <mcs-accordion-panel-header mcsPanelHeaderDef>
                    <span>{{ nic.name }}</span>
                    <span *ngIf="nic.isPrimary">({{ textContent.nics.primary }})</span>
                  </mcs-accordion-panel-header>

                  <mcs-item>
                    <span>{{ textContent.nics.ipAllocationMode }}:</span>
                    <span>{{ nic.ipAllocationModeLabel }}</span>
                  </mcs-item>
                  <mcs-item>
                    <span>{{ textContent.nics.ipAddresses }}:</span>
                    <ng-container *ngIf="nic.logicalIpAddresses; else noIpAddressTemplate">
                      <mcs-list spacing="auto">
                        <mcs-list-item *ngFor="let item of nic.logicalIpAddresses">
                          {{ item }}
                        </mcs-list-item>
                      </mcs-list>
                    </ng-container>

                    <ng-template #noIpAddressTemplate>
                      <span read-only [ngSwitch]="nic?.ipAllocationMode">
                        <ng-container *ngSwitchCase="ipAllocationModeEnum.Dhcp">
                          {{ textContent.nics.dhcpLabel }}
                        </ng-container>
                        <ng-container *ngSwitchDefault>
                          {{ textContent.nics.staticLabel }}
                        </ng-container>
                      </span>
                    </ng-template>
                  </mcs-item>
                </mcs-accordion-panel>
              </mcs-accordion>
            </ng-container>

            <ng-template #noContentMessage>
              <mcs-data-status-empty>
                {{ textContent.nics.noContentMessage }}
              </mcs-data-status-empty>
            </ng-template>
          </mcs-presentation-panel>
        </mcs-grid-column>
      </mcs-grid-row>

      <mcs-grid-row>

        <!-- VM Media -->
        <mcs-grid-column sizeSm="12" sizeLg="6"
          *mcsAccessControl="[]; feature: 'enableDedicatedVmMediaView';
          validateWhen: serverDetails.server.isDedicated">

          <mcs-presentation-panel mcsId="vm-media">
            <ng-container mcsPresentationPanelHeader>
              <mcs-item>
                <h2>{{ textContent.media.title }}</h2>
                <ng-container *mcsAccessControl="['VmEdit']">
                  <a (click)="setViewMode(serverManagementViewEnum.ManageMedia)"
                    [disabled]="!serverDetails.server.executable"
                    mcsId="attach-media"
                    mcsEventTracker="attach-media-option"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page">
                    {{ textContent.media.attach }}
                  </a>
                </ng-container>
              </mcs-item>
            </ng-container>

            <ng-container *ngIf="serverMedia$ | async as serverMedia">
              <mcs-list spacing="xsmall"
                *ngIf="serverMedia | mcsIsNotNullOrEmpty; else noMediaTemplate">

                <mcs-list-item *ngFor="let media of serverMedia">
                  <mcs-item>
                    <ng-container *mcsAccessControl="['VmEdit']">
                      <mcs-loader *ngIf="mediaIsDetaching(media)" size="small"
                        [mcsTooltip]="serverDetails.server.processingText"></mcs-loader>

                      <mcs-icon *ngIf="!mediaIsDetaching(media)" mcsCursor="pointer"
                        [key]="ejectIconKey" size="small"
                        (click)="showDetachMediaDialog(serverDetails.server, media)"
                        mcsId="show-detach-media"
                        [mcsTooltip]="textContent.media.detach"
                        mcsEventTracker="detach-media-option"
                        mcsEventCategory="server"
                        mcsEventLabel="server-details-page"></mcs-icon>
                    </ng-container>
                    <span>{{ media.name }}</span>
                  </mcs-item>
                </mcs-list-item>
              </mcs-list>
            </ng-container>

            <ng-template #noMediaTemplate>
              <mcs-data-status-empty mcsDataEmpty>
                <span>{{ textContent.media.noContentMessage }}</span>
              </mcs-data-status-empty>
            </ng-template>

          </mcs-presentation-panel>
        </mcs-grid-column>

        <!-- VM Support Identifiers -->
        <mcs-grid-column sizeSm="12" sizeLg="6">
          <mcs-presentation-panel>
            <ng-container mcsPresentationPanelHeader>
              <h2>{{ textContent.serviceInformation.title }}</h2>
            </ng-container>

            <mcs-item>
              <span>{{ textContent.serviceInformation.vdc }}:</span>
              <span [innerHTML]="serverDetails.server.platform?.resourceName | mcsDataLabel"></span>
            </mcs-item>

            <mcs-item *ngIf="serverDetails.server.serviceId && !serverDetails.server.isDedicated">
              <span>{{ textContent.serviceInformation.serviceId }}:</span>
              <span>{{ serverDetails.server.serviceId }}</span>
            </mcs-item>

            <mcs-item>
              <span>{{ textContent.serviceInformation.vmWareId }}:</span>
              <span [innerHTML]="serverDetails.server.instanceId | mcsDataLabel"></span>
            </mcs-item>
          </mcs-presentation-panel>
        </mcs-grid-column>
      </mcs-grid-row>
    </mcs-grid>
  </div>

  <!-- Manage Server Scale -->
  <div [@fadeIn] *ngSwitchCase="serverManagementViewEnum.ManageScale">
    <mcs-presentation-panel>
      <ng-container mcsPresentationPanelHeader>
        <h2>{{ textContent.manageScale.header }}</h2>
      </ng-container>
      <p>{{ textContent.manageScale.description }}</p>

      <div class="action-box" [disabled]="!serverDetails.server.executable">
        <mcs-server-manage-scale [resource]="serverDetails.resource"
          [serverCompute]="serverDetails.server.compute"
          [allowScaleDown]="serverDetails.server.isSelfManaged"
          (dataChange)="onScaleChanged($event)">

          <ng-container mcsManageScaleHeader>
            <h2>Scaling {{ serverDetails.server.name }}</h2>
          </ng-container>
        </mcs-server-manage-scale>

        <mcs-data-status-warning *ngIf="serverDetails.server.isPoweredOn">
          <span>{{ textContent.manageScale.warning }}</span>
        </mcs-data-status-warning>

        <div class="action-items">
          <a (click)="onCancelScale()"
            mcsId="scale-cancel"
            mcsEventTracker="scale-cancel"
            mcsEventCategory="server"
            mcsEventLabel="server-details-page">
            {{ textContent.manageScale.cancel }}
          </a>

          <button mcsButton
            arrow="right" size="small"
            [disabled]="!manageScale?.hasChanged"
            (click)="updateScale(serverDetails.server)"
            mcsId="scale-option"
            mcsEventTracker="scale-option"
            mcsEventCategory="server"
            mcsEventLabel="server-details-page">
            {{ textContent.manageScale.scale }}
          </button>
        </div>
      </div>
    </mcs-presentation-panel>
  </div>

  <!-- Manage Server Media -->
  <div [@fadeIn] *ngSwitchCase="serverManagementViewEnum.ManageMedia">
    <mcs-presentation-panel>
      <ng-container mcsPresentationPanelHeader>
        <h2>{{ textContent.media.manageHeader }}</h2>
      </ng-container>

      <div class="action-box" [disabled]="!serverDetails.server.executable">
        <mcs-server-manage-media [catalogs]="resourceCatalogs$ | async"
          [(selectedCatalog)]="selectedCatalog">

          <ng-container mcsManageMediaHeader>
            <h2>{{ textContent.media.attachHeading }}</h2>
          </ng-container>
        </mcs-server-manage-media>

        <div class="action-items">
          <a (click)="setViewMode(serverManagementViewEnum.None)"
            mcsId="attach-media-cancel"
            mcsEventTracker="attach-media-cancel"
            mcsEventCategory="server"
            mcsEventLabel="server-details-page">
            {{ textContent.media.cancel }}
          </a>

          <button mcsButton
            arrow="right" size="small"
            (click)="attachMedia(serverDetails.server, selectedCatalog)"
            [disabled]="!selectedCatalog"
            mcsId="attach-media"
            mcsEventTracker="attach-media"
            mcsEventCategory="server"
            mcsEventLabel="server-details-page">
            {{ textContent.media.attach }}
          </button>
        </div>
      </div>
    </mcs-presentation-panel>
  </div>
</ng-container>