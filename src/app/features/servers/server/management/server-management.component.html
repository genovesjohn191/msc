<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="managementContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div #managementContent>
    <div *ngIf="!scaleOptionIsVisible && !isAttachMedia" class="content-grid">
      <div class="grid-row">
        <div class="grid-column container-wrapper break-on-small">
          <h4 class="container-header">{{ textContent.vmProperties.title }}</h4>
          <mcs-list spacing="xsmall">
            <!-- Status -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.status }}:</span>
              <span>{{ server.statusLabel }}</span>
            </mcs-list-item>
            <!-- Image -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.image }}:</span>
              <span>{{ server.operatingSystem?.guestOs }}</span>
            </mcs-list-item>
            <!-- Zone -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.zone }}:</span>
              <span>{{ server.availabilityZone }}</span>
            </mcs-list-item>
            <!-- Configuration -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.configuration }}:</span>
              <span>{{ serverMemoryValue }} / {{ serverCpuValue }}</span>
              <span *mcsAccessControl="['VmEdit']">
                <ng-container *mcsIsSelfManagedServer="server">
                  <a *ngIf="!isScaling" (click)="showScaleOption()"
                    mcsEventTracker="scale-option"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page"
                    [disabled]="!server.executable">
                    {{ textContent.performanceScale.scale }}</a>
                  <mcs-icon *ngIf="isScaling" [key]="spinnerIconKey" size="medium"
                    [mcsTooltip]="textContent.performanceScale.scaling"></mcs-icon>
                </ng-container>
              </span>
            </mcs-list-item>
          </mcs-list>
        </div>

        <!-- Console -->
        <div class="grid-column container-wrapper break-on-small">
          <h4 flex="none" class="container-header">{{ textContent.vmConsole.title }}</h4>
          <div *ngIf="consoleEnabled" class="inline-block"
            cursor="pointer"
            (click)="onClickViewConsole()"
            mcsEventTracker="view-console"
            mcsEventCategory="server"
            mcsEventLabel="server-details-page">
            <div class="image-thumbnail dark" cursor="pointer">
              <img #thumbnailElement/>
            </div>
            <a>{{ textContent.vmConsole.link }}</a>
          </div>
          <div *ngIf="!consoleEnabled">
            <div class="inline-block">
              <mcs-icon [key]="consoleIconKey" size="110px"></mcs-icon>
            </div>
            <div read-only>
              <span *ngIf="server.isPoweredOff">
                {{ textContent.vmConsole.serverPoweredOff }}
              </span>
              <span *ngIf="server.isSuspended">
                {{ textContent.vmConsole.serverSuspended }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-column container-wrapper break-on-small">
          <h4 class="container-header">{{ textContent.storage.title }}
            <ng-container *mcsAccessControl="['VmEdit']">
              <a *mcsIsSelfManagedServer="server"
                [disabled]="!server.executable"
                [routerLink]="['../storage']">
                {{ textContent.storage.manage }}
              </a>
            </ng-container>
          </h4>
          <div>
            <div *ngIf="!hasStorageInformation">
              <span read-only>{{ textContent.storage.noContentMessage }}</span>
            </div>
            <mcs-list spacing="xsmall" *ngIf="hasStorageInformation">
              <!-- Primary Volume -->
              <mcs-list-item *ngFor="let storage of server.storageDevices">
                <span>{{ storage.name }}:</span>
                <span>{{ storage.sizeMB | mcsDataSize: 'MB' }}</span>
              </mcs-list-item>
              <!-- Storage Policy -->
              <!-- TODO: Will confirm to Orch API where to pull this data -->
              <!-- <mcs-list-item *ngIf="server.environment?.resource?.storage?.name">
                <span>{{ textContent.storage.storagePolicy }}:</span>
                <span>{{ server.environment?.resource?.storage?.name }}</span>
              </mcs-list-item> -->
            </mcs-list>
          </div>
        </div>

        <div class="grid-column container-wrapper break-on-small">
          <h4 class="container-header">{{ textContent.nics.title }}</h4>
          <div>
            <div *ngIf="!hasNics">
              <span read-only>
                {{ textContent.nics.noContentMessage }}
              </span>
            </div>

            <!-- Server NICs -->
            <mcs-accordion *ngIf="hasNics" [multi]="true">
              <mcs-accordion-panel *ngFor="let nic of server.nics; let i = index"
                [expanded]="i === 0">
                <mcs-accordion-panel-header mcsPanelHeaderDef>
                  <span>{{ nic.name }}</span>
                  <span *ngIf="nic.isPrimary">({{ textContent.nics.primary }})</span>
                </mcs-accordion-panel-header>
                <div class="block-items-xsmall">

                  <ng-template #noIpAddressTemplate>
                    <span [ngSwitch]="nic?.ipAllocationMode">
                      <ng-container *ngSwitchCase="ipAllocationModeEnum.Dhcp">
                        {{ textContent.nics.dhcpLabel }}
                      </ng-container>
                      <ng-container *ngSwitchDefault>
                        {{ textContent.nics.staticLabel }}
                      </ng-container>
                    </span>
                  </ng-template>

                  <div class="form-field-inline">
                    <span class="form-field-label">{{ textContent.nics.ipAllocationMode }}:</span>
                    <span>{{ nic.ipAllocationModeLabel }}</span>
                  </div>
                  <div class="form-field-inline">
                    <span class="form-field-label">{{ textContent.nics.ipAddresses }}:</span>
                    <ng-container *ngIf="getNicIpAddresses(nic); else noIpAddressTemplate">
                      <mcs-list spacing="auto">
                        <mcs-list-item *ngFor="let item of getNicIpAddresses(nic)">
                          {{ item }}
                        </mcs-list-item>
                      </mcs-list>
                    </ng-container>
                  </div>
                </div>
              </mcs-accordion-panel>
            </mcs-accordion>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-column container-wrapper break-on-small">
          <h4 class="container-header">
            {{ textContent.media.title }}
            <span [mcsTooltip]="textContent.media.noAvailableMedia"
              [mcsTooltipShow]="!hasAvailableMedia">
              <ng-container *mcsAccessControl="['VmEdit']">
                <a flex="auto" *mcsIsSelfManagedServer="server" (click)="onAttachMedia()"
                  [disabled]="attachMediaIsDisabled"
                  mcsEventTracker="attach-media-option"
                  mcsEventCategory="server"
                  mcsEventLabel="server-details-page">
                  {{ textContent.media.attach }}
                </a>
              </ng-container>
            </span>
          </h4>

          <div *ngIf="!hasMedia">
            <span read-only>{{ textContent.media.noContentMessage }}</span>
          </div>
          <mcs-list *ngIf="hasMedia" spacing="xsmall">
            <!-- Media Items -->
            <mcs-list-item *ngFor="let media of server.media">
              <div display-flex="row" class="horizontal-items-spacing-xsmall">
                <span>{{ media.name }}</span>
                <span *mcsAccessControl="['VmEdit']">
                  <ng-container *mcsIsSelfManagedServer="server">
                    <ng-container *ngIf="media.isProcessing; else detachMedia">
                      <mcs-icon [key]="spinnerIconKey" size="small" class="hidden-small"
                        [mcsTooltip]="jobSummaryInfo" mcsTooltipPosition="right"></mcs-icon>
                    </ng-container>
                    <ng-template #detachMedia>
                      <a (click)="onDetachMedia(media)"
                        [disabled]="!server.executable"
                        mcsEventTracker="detach-media-option"
                        mcsEventCategory="server"
                        mcsEventLabel="server-details-page">
                        {{ textContent.media.detach }}
                      </a>
                    </ng-template>
                  </ng-container>
                </span>
              </div>
            </mcs-list-item>
          </mcs-list>
        </div>

        <div class="grid-column container-wrapper break-on-small">
          <h4 class="container-header">{{ textContent.supportIdentifiers.title }}</h4>
          <mcs-list spacing="xsmall">
            <!-- VDC -->
            <mcs-list-item>
              <span>{{ textContent.supportIdentifiers.vdc }}:</span>
              <span>{{ server.platform?.resourceName }}</span>
            </mcs-list-item>
            <!-- MacView Service ID -->
            <mcs-list-item *ngIf="server.serviceId">
              <span>{{ textContent.supportIdentifiers.macViewServiceId }}:</span>
              <span>{{ server.serviceId }}</span>
            </mcs-list-item>
            <!-- VMWare ID -->
            <mcs-list-item>
              <span>{{ textContent.supportIdentifiers.vmWareId }}:</span>
              <span>{{ server.instanceId }}</span>
            </mcs-list-item>
          </mcs-list>
        </div>
      </div>
    </div>

    <ng-container *mcsAccessControl="['VmEdit']">
      <ng-container *mcsIsSelfManagedServer="server">
        <div *ngIf="scaleOptionIsVisible" class="server-performance-scale">
          <div class="container-wrapper" [disabled]="!server.executable">
            <h4 class="container-header">Scaling {{ server.name }}</h4>
            <mcs-server-performance-scale *ngIf="availableMemoryMB && availableCpu"
              [memoryMB]="serverMemoryMB" [cpuCount]="serverCpuCount"
              [availableMemoryMB]="availableMemoryMB" [availableCpuCount]="availableCpu"
              (scaleChanged)="onScaleChanged($event)">
            </mcs-server-performance-scale>

            <p *ngIf="isPoweredOn" class="horizontal-items-spacing-small"
              display-flex="row" align-items="center" justify-content="center">
              <mcs-icon [key]="warningIconKey" size="medium"></mcs-icon>
              <span>{{ textContent.performanceScale.warning }}</span>
            </p>

            <div class="scaling" display-flex="row" align-items="center" justify-content="space-between">
              <a class="text-underline"
                (click)="cancelScale()"
                mcsEventTracker="scale-cancel"
                mcsEventCategory="server"
                mcsEventLabel="server-details-page">
                {{ textContent.performanceScale.cancel }}</a>

                <button class="scale" mcsButton id="ctaScaleServer" arrow="right"
                  [disabled]="!hasUpdate" (click)="onClickScale()"
                  mcsEventTracker="scale-option"
                  mcsEventCategory="server"
                  mcsEventLabel="server-details-page">
                    {{ textContent.performanceScale.scale }}
                </button>
            </div>
          </div>
        </div>

        <div *ngIf="isAttachMedia" [ngStyle]="{width: '300px'}">
          <div class="container-wrapper" [disabled]="attachMediaIsDisabled">
            <h4 class="container-header">{{ textContent.media.attachHeading }}</h4>
            <mcs-form-field>
              <mcs-select [placeholder]="textContent.media.mediaSelect.placeholder"
                [(ngModel)]="selectedMedia">
                <mcs-select-group [header]="textContent.media.mediaSelect.header">
                  <mcs-select-item *ngFor="let media of resourceMediaList" [value]="media">
                    {{ media.itemName }}
                  </mcs-select-item>
                </mcs-select-group>
              </mcs-select>
            </mcs-form-field>

            <div class="action-items">
              <a (click)="cancelAttachMedia()"
                mcsEventTracker="attach-media-cancel"
                mcsEventCategory="server"
                mcsEventLabel="server-details-page">
                {{ textContent.media.cancel }}
              </a>

              <button mcsButton id="ctaAttachMedia" arrow="right" size="small"
                [disabled]="!selectedMedia" (click)="attachMedia()"
                mcsEventTracker="attach-media"
                mcsEventCategory="server"
                mcsEventLabel="server-details-page">
                {{ textContent.media.attach }}
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>