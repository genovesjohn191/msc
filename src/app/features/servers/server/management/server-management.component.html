<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="managementContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div #managementContent>
    <div *ngIf="!isActiveScale && !isAttachMedia" class="content-grid">
      <div class="grid-row">
        <div class="grid-column">
          <h3 class="grid-content-header">{{ textContent.vmProperties.title }}</h3>
          <mcs-list spacing="xsmall" class="grid-content-body">
            <!-- Status -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.status }}:</span>
              <span>{{ serverStatusLabel }}</span>
            </mcs-list-item>
            <!-- Image -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.image }}:</span>
              <span>{{ server.operatingSystem?.guestOs }}</span>
            </mcs-list-item>
            <!-- Zone -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.zone }}:</span>
              <span>{{ server.availabilityZone }}</span>
            </mcs-list-item>
            <!-- Configuration -->
            <mcs-list-item>
              <span>{{ textContent.vmProperties.configuration }}:</span>
              <span>{{ serverMemoryValue }} / {{ serverCpuValue }}</span>
              <span *mcsHasPermission="['VmEdit']">
                <a *ngIf="!isScaling" (click)="scaleServer()" [disabled]="scalingIsDisabled">
                {{ textContent.performanceScale.scale }}</a>
              </span>
              <mcs-icon *ngIf="isScaling" [key]="spinnerIconKey" size="medium"
                [mcsTooltip]="textContent.performanceScale.scaling"></mcs-icon>
            </mcs-list-item>
          </mcs-list>
        </div>

        <!-- Console -->
        <div class="grid-column">
          <h3 class="grid-content-header">{{ textContent.vmConsole.title }}</h3>
          <div display-flex="column" align-items="flex-start"
            (click)="onClickViewConsole()" [disabled]="!consoleEnabled">
            <div class="thumbnail-container">
              <img #thumbnailElement class="thumbnail"/>
            </div>
            <a>{{ textContent.vmConsole.link }}</a>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-column">
          <h3 class="grid-content-header">{{ textContent.storage.title }}
            <a *mcsHasPermission="['VmEdit']" [routerLink]="['../storage']">
              {{ textContent.storage.manage }}
            </a>
          </h3>
          <div class="grid-content-body">
            <div *ngIf="!hasStorageInformation">
              <span class="missing-data-info">{{ textContent.storage.noContentMessage }}</span>
            </div>
            <mcs-list spacing="xsmall" *ngIf="hasStorageInformation">
              <!-- Primary Volume -->
              <mcs-list-item>
                <span>{{ textContent.storage.primaryVolume }}:</span>
                <span>{{ primaryVolume }}</span>
              </mcs-list-item>
              <!-- Secondary Volume -->
              <mcs-list-item *ngIf="secondaryVolumes">
                <span>{{ textContent.storage.secondaryVolumes }}:</span>
                <span>{{ secondaryVolumes }}</span>
              </mcs-list-item>
              <!-- Storage Policy -->
              <!-- TODO: Will confirm to Orch API where to pull this data -->
              <!-- <mcs-list-item *ngIf="server.environment?.resource?.storage?.name">
                <span>{{ textContent.storage.storagePolicy }}:</span>
                <span>{{ server.environment?.resource?.storage?.name }}</span>
              </mcs-list-item> -->
            </mcs-list>
          </div>
        </div>

        <div class="grid-column">
          <h3 class="grid-content-header">{{ textContent.nics.title }}</h3>
          <div class="grid-content-body">
            <div *ngIf="!hasNics">
              <span class="missing-data-info">
                {{ textContent.nics.noContentMessage }}
              </span>
            </div>
            <mcs-list spacing="xsmall">
              <!-- Server NICs -->
              <mcs-list-item *ngFor="let nic of server.nics">
                <div display-flex="row" class="horizontal-items-spacing-xsmall">
                  <span>{{ textContent.nics.interface }} {{ nic.index }}: </span>
                  <span>{{ nic.ipAddress }}</span>
                </div>
              </mcs-list-item>
            </mcs-list>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-column">
          <h3 class="grid-content-header">
            {{ textContent.media.title }}
            <span [mcsTooltip]="textContent.media.noAvailableMedia"
              [mcsTooltipShow]="!hasAvailableMedia">
              <a flex="auto" *mcsHasPermission="['VmEdit']"
                (click)="onAttachMedia()" [disabled]="mediaIsDisabled || !hasAvailableMedia">
                {{ textContent.media.attach }}
              </a>
            </span>
          </h3>

          <div class="grid-content-body">
            <div *ngIf="!hasMedia">
              <span class="missing-data-info">{{ textContent.media.noContentMessage }}</span>
            </div>
            <mcs-list *ngIf="hasMedia" spacing="xsmall">
              <!-- Media Items -->
              <mcs-list-item *ngFor="let media of server.media">
                <div display-flex="row" class="horizontal-items-spacing-xsmall">
                  <span>{{ media.name }}</span>
                  <span *mcsHasPermission="['VmEdit']">
                    <ng-container *ngIf="media.isProcessing; else detachMedia">
                      <mcs-icon [key]="spinnerIconKey"
                        size="small" class="hidden-small"
                        [mcsTooltip]="jobSummaryInfo"
                        mcsTooltipPosition="right"></mcs-icon>
                    </ng-container>
                    <ng-template #detachMedia>
                      <a (click)="onDetachMedia(media)"
                        [disabled]="mediaIsDisabled">
                        {{ textContent.media.detach }}
                      </a>
                    </ng-template>
                  </span>
                </div>
              </mcs-list-item>
            </mcs-list>
          </div>
        </div>

        <div class="grid-column">
          <h3 class="grid-content-header">{{ textContent.supportIdentifiers.title }}</h3>
          <mcs-list spacing="xsmall" class="grid-content-body">
            <!-- VDC -->
            <mcs-list-item>
              <span>{{ textContent.supportIdentifiers.vdc }}:</span>
              <span>{{ server.platform?.resourceName }}</span>
            </mcs-list-item>
            <!-- MacView Service ID -->
            <mcs-list-item>
              <span>{{ textContent.supportIdentifiers.macViewServiceId }}:</span>
              <span>{{ server.serviceId }}</span>
            </mcs-list-item>
            <!-- VMWare ID -->
            <mcs-list-item>
              <span>{{ textContent.supportIdentifiers.vmWareId }}:</span>
              <span>{{ server.instanceId }}</span>
            </mcs-list-item>
          </mcs-list>
        </div>
      </div>
    </div>

    <div *ngIf="isActiveScale" class="server-performance-scale">
      <div class="vertical-items-spacing-medium">
        <h3 class="grid-content-header">Scaling {{ server.managementName }}</h3>
        <mcs-server-performance-scale *ngIf="availableMemoryMB && availableCpu"
          [memoryMB]="serverMemoryMB" [cpuCount]="serverCpuCount"
          [availableMemoryMB]="availableMemoryMB" [availableCpuCount]="availableCpu"
          (scaleChanged)="onScaleChanged($event)">

          <!--Performance scale container-->
          <span slider-details>
            {{ textContent.performanceScale.sliderMessage }}
          </span>
          <span custom-details>
            {{ textContent.performanceScale.customMessage }}
          </span>
        </mcs-server-performance-scale>

        <p *ngIf="isPoweredOn" class="horizontal-items-spacing-small"
          display-flex="row" align-items="center" justify-content="center">
          <mcs-icon [key]="warningIconKey" size="medium"></mcs-icon>
          <span>{{ textContent.performanceScale.warning }}</span>
        </p>

        <div class="scaling" display-flex="row" align-items="center" justify-content="space-between">
          <a class="text-underline" (click)="cancelScale()">
            {{ textContent.performanceScale.cancel }}</a>

          <button *mcsHasPermission="['VmEdit']" class="scale"
            mcsButton id="ctaScaleServer" arrow="right"
            [disabled]="!hasUpdate || isProcessingJob" (click)="onClickScale()">
              {{ textContent.performanceScale.scale }}
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="isAttachMedia" [ngStyle]="{width: '300px'}">
      <div class="vertical-items-spacing-medium" [disabled]="isProcessingJob">
        <h3 class="grid-content-header">{{ textContent.media.attachHeading }}</h3>
        <mcs-select [(ngModel)]="selectedMedia"
          [placeholder]="textContent.media.mediaSelect.placeholder">
          <mcs-select-group [header]="textContent.media.mediaSelect.header">
            <mcs-select-item *ngFor="let media of resourceMediaList" [value]="media.itemName">
              {{ media.itemName }}
            </mcs-select-item>
          </mcs-select-group>
        </mcs-select>
        <div display-flex="row" align-items="center" justify-content="space-between">
          <a class="text-underline" (click)="cancelAttachMedia()">
            {{ textContent.media.cancel }}
          </a>

          <button *mcsHasPermission="['VmEdit']"
            mcsButton id="ctaAttachMedia" arrow="right" size="small"
            [disabled]="!selectedMedia || isProcessingJob" (click)="attachMedia()">
            {{ textContent.media.attach }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>