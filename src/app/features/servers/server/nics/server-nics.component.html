<mcs-presentation-panel mcsId="nics" *ngIf="server$ | async as server">
  <ng-container mcsPresentationPanelHeader>
    <h2>{{ 'serverNics.title' | translate }}</h2>
  </ng-container>

  <ng-container [ngSwitch]="nicMethodType">
    <mcs-section [@fadeIn] *ngSwitchCase="serverNicMethodTypeEnum.AddNic">
      <!-- NICs Table -->
      <mcs-table [dataSource]="nicsDataSource">
        <!-- NIC Column -->
        <ng-container mcsColumnDef="nic">
          <mcs-header-cell *mcsHeaderCellDef hidden-small>
            {{ 'serverNics.columnHeaders.nic' | translate }}
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row" hidden-small>
            <ng-container *ngIf="nicIsInProgress(row); else nicIndexTemplate">
              <mcs-loader size="small"
                [mcsTooltip]="server.processingText"
                mcsTooltipPosition="right"></mcs-loader>
            </ng-container>
            <ng-template #nicIndexTemplate>
              <span>{{ row.index }}</span>
            </ng-template>
          </mcs-data-cell>
        </ng-container>

        <!-- Network Column -->
        <ng-container mcsColumnDef="network">
          <mcs-header-cell *mcsHeaderCellDef>
            {{ 'serverNics.columnHeaders.network' | translate }}
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row" text-wrap>
            <span [innerHTML]="row.logicalNetworkName | mcsDataLabel"></span>
          </mcs-data-cell>
        </ng-container>

        <!-- Primary Column -->
        <ng-container mcsColumnDef="primary">
          <mcs-header-cell *mcsHeaderCellDef hidden-small>
            {{ 'serverNics.columnHeaders.primary' | translate }}
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row" hidden-small>
            <mcs-icon *ngIf="row.isPrimary" padding-left-medium
              [key]="checkIconKey" size="small"></mcs-icon>
          </mcs-data-cell>
        </ng-container>

        <!-- Type Column -->
        <ng-container mcsColumnDef="type">
          <mcs-header-cell *mcsHeaderCellDef hidden-small>
            {{ 'serverNics.columnHeaders.type' | translate }}
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row" hidden-small>
            <span [innerHTML]="row.deviceTypeLabel | mcsDataLabel"></span>
          </mcs-data-cell>
        </ng-container>

        <!-- IP Mode Column -->
        <ng-container mcsColumnDef="ipMode"> 
          <mcs-header-cell *mcsHeaderCellDef hidden-small>
            {{ 'serverNics.columnHeaders.ipMode' | translate }}
          </mcs-header-cell>
            <mcs-data-cell *mcsDataCellDef="let row" hidden-small>
              <ng-container *ngIf="isVMWareToolsInstalled; else notInstalled">
                <ng-container *ngIf="isVMWareToolsRunning; else notRunning">
                  <span [innerHTML]="row.ipAllocationModeLabel | mcsDataLabel"></span>
                </ng-container>
              </ng-container>
            </mcs-data-cell>
        </ng-container>

        <!-- IP Addresses Column -->
        <ng-container mcsColumnDef="ipAddresses">
          <mcs-header-cell *mcsHeaderCellDef>
            {{ 'serverNics.columnHeaders.ipAddresses' | translate }}
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row"  hidden-small>
            <ng-container *ngIf="isVMWareToolsInstalled; else notInstalled">
              <ng-container *ngIf="isVMWareToolsRunning; else notRunning">
                <mcs-list spacing="none">
                  <mcs-list-item *ngFor="let ipAddress of row.logicalIpAddresses">
                    <span [innerHTML]="ipAddress | mcsDataLabel"></span>
                  </mcs-list-item>
                </mcs-list>
              </ng-container>
            </ng-container>
          </mcs-data-cell>
        </ng-container>
        
        <ng-template #notRunning>
          <mcs-data-status-empty [mcsTooltip]="'serverManagement.nics.nicsUnavailableNotRunningTooltip' | translate">
            {{ 'serverManagement.nics.nicsUnavailableNotRunning' | translate }}
          </mcs-data-status-empty>
        </ng-template>
        
        <ng-template #notInstalled>
          <mcs-data-status-empty [mcsTooltip]="'serverManagement.nics.nicsUnavailableNotInstalledTooltip' | translate">
            {{ 'serverManagement.nics.nicsUnavailableNotInstalled' | translate }}
          </mcs-data-status-empty>
        </ng-template>

        <!-- Action Column -->
        <ng-container mcsColumnDef="action" *mcsAccessControl="serverPermission.vmNicEdit">
          <mcs-header-cell *mcsHeaderCellDef class="action-header-cell">
          </mcs-header-cell>
          <mcs-data-cell *mcsDataCellDef="let row">
            <mcs-item *ngIf="(resource$ | async)?.hasNetworks">
              <span *ngIf="isEditNicEnabled(server, row)">
                <a [disabled]="!server.executable || isSnapshotProcessing"
                    (click)="openEditNicWindow(row)"
                    mcsId="edit-nic"
                    mcsEventTracker="edit-nic"
                    mcsEventCategory="server"
                    mcsEventLabel="server-details-page">
                  {{ 'serverNics.editLink' | translate }}
                </a>
              </span>
              <span>
                <a *ngIf="!row.isPrimary"
                  [disabled]="!server.executable || isSnapshotProcessing"
                  (click)="deleteNic(server, row)"
                  mcsId="delete-nic"
                  mcsEventTracker="delete-nic"
                  mcsEventCategory="server"
                  mcsEventLabel="server-details-page">
                  {{ 'serverNics.deleteLink' | translate }}
                </a>
              </span>
            </mcs-item>
          </mcs-data-cell>
        </ng-container>

        <!-- Data Status Integration -->
        <ng-container mcsDataStatusDef>
          <mcs-data-empty *mcsDataEmptyDef>
            <span>{{ 'serverNics.noNics' | translate }} </span>
          </mcs-data-empty>
          <mcs-data-error *mcsDataErrorDef>
            <span>{{ 'serverNics.errorGettingNics' | translate }}</span>
          </mcs-data-error>
        </ng-container>

        <!-- Header and Data row -->
        <mcs-header-row *mcsHeaderRowDef="nicsColumns"></mcs-header-row>
        <mcs-data-row *mcsDataRowDef="let row; columns: nicsColumns;"></mcs-data-row>
      </mcs-table>

      <!-- Adding NIC -->
      <ng-container *mcsAccessControl="serverPermission.vmNicEdit">
        <ng-container *ngIf="resourceNetworks$ | async as resourceNetworks">
          <div class="action-box" *ngIf="canAddNic(server, resourceNetworks)"
            [@fadeIn] [disabled]="!server.executable">

            <mcs-server-manage-network *mcsComponentHandler
              [resourceId]="(resource$ | async)?.id"
              [networks]="resourceNetworks"
              (dataChange)="onNetworkChanged($event)"
              [selectedNetwork]="selectedNetwork">

              <ng-container mcsManageNetworkHeader>
                <h2>{{ 'serverNics.addHeading' | translate }}</h2>
              </ng-container>

              <ng-container mcsManageNetworkWarning>
                <mcs-data-status-warning>
                  {{ 'serverNics.warningEditingNic' | translate }}
                </mcs-data-status-warning>
              </ng-container>
            </mcs-server-manage-network>

            <div class="action-items">
              <button mcsButton
                arrow="right" size="small"
                [disabled]="!inputIsValid"
                (click)="addNic(server)"
                mcsId="add-nic"
                mcsEventTracker="add-nic"
                mcsEventCategory="server"
                mcsEventLabel="server-details-page">
                {{ 'serverNics.addButton' | translate }}
              </button>
            </div>
          </div>
        </ng-container>
        <mcs-data-status-warning *ngIf="hasReachedNicsLimit(server)">
          <span>{{ 'serverNics.reachedNetworksLimit' | translate }}</span>
        </mcs-data-status-warning>
      </ng-container>
    </mcs-section>

    <!-- Edit NIC -->
    <mcs-section [@fadeIn] *ngSwitchCase="serverNicMethodTypeEnum.EditNic">
      <ng-container *ngIf="resourceNetworks$ | async as resourceNetworks">
        <div class="action-box" [disabled]="!server.executable">
          <mcs-server-manage-network
            [networks]="resourceNetworks"
            [resourceId]="(resource$ | async)?.id"
            (dataChange)="onNetworkChanged($event)"
            [targetNic]="selectedNic"
            [selectedNetwork]="selectedNetwork">

            <ng-container mcsManageNetworkHeader>
              <h2>{{ 'serverNics.editHeading' | translate }} {{ selectedNic.index }}</h2>
            </ng-container>

            <ng-container mcsManageNetworkWarning>
              <mcs-data-status-warning>
                {{ 'serverNics.warningEditingNic' | translate }}
              </mcs-data-status-warning>
            </ng-container>
          </mcs-server-manage-network>

          <div class="action-items">
            <a (click)="closeEditNicWindow(resourceNetworks)"
              mcsId="close-update-nic"
              mcsEventTracker="update-nic-close"
              mcsEventCategory="server"
              mcsEventLabel="server-details-page">Cancel</a>
            <button *mcsAccessControl="serverPermission.vmEdit"
              mcsButton arrow="right" size="small"
              [disabled]="!manageNetwork?.hasChanged"
              (click)="updateNic(server, resourceNetworks)"
              mcsId="update-nic"
              mcsEventTracker="update-nic"
              mcsEventCategory="server"
              mcsEventLabel="server-details-page">
              {{ 'serverNics.updateButton' | translate }}
            </button>
          </div>
        </div>
      </ng-container>
    </mcs-section>
  </ng-container>
</mcs-presentation-panel>

<ng-template #submitDialogTemplate>
  <mcs-dialog>
    <mcs-dialog-header [dialogRefTemplate]="dialogRef">
      <h1>{{ 'dialog.nicDelete.title' | translate  }}</h1>
    </mcs-dialog-header>

    <mcs-dialog-content>
      <mcs-section>
        <mcs-item>
          <mcs-icon [key]="errorIconKey" color="red"></mcs-icon>
          <span margin-left-medium [innerHtml]="'dialog.nicDelete.includesMemory.message' | translate"></span>
        </mcs-item>
      </mcs-section>
    </mcs-dialog-content>

    <mcs-dialog-actions>
      <button mcsButton mcsId="close-server-delete-nic"
        size="small" (click)="closeDialog()">
        {{ 'action.dismiss' | translate }}
      </button>
    </mcs-dialog-actions>
  </mcs-dialog>
</ng-template>