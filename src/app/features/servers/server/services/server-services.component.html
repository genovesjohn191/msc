<ng-container *ngIf="server$ | async as server">
  <ng-container [ngSwitch]="serviceView$ | async">

    <!-- Default View -->
    <section [@fadeIn] *ngSwitchCase="serverServicesViewOption.Default">
      <!-- Operating System Updates -->
      <mcs-presentation-panel *mcsAccessControl="serverPermission.vmPatchManagement; feature: 'EnableServerOsUpdates'">
        <ng-container mcsPresentationPanelHeader>
          <h2>{{ 'serverServices.operatingSystemUpdates.title' | translate }}</h2>
        </ng-container>
        <p>{{ 'serverServices.operatingSystemUpdates.description' | translate }}</p>

        <mcs-section>
          <mcs-form-message #formMessage></mcs-form-message>
          <ng-container *ngIf="server.osAutomationAvailable; else osAutomationNotAvailable">
            <mcs-data-status [dataStatusFactory]="dataStatusFactory">
              <mcs-data-status-success mcsDataSuccess>

                <mcs-grid *ngIf="updatesDetails$ | async as updatesDetails">
                  <!-- Patch -->
                  <mcs-grid-row>
                    <mcs-grid-column>
                      <mcs-service-os-updates-patch
                        [osUpdatesDetails]="updatesDetails"
                        [server]="server"
                        [jobsMap]="jobsMap$ | async"
                        (inspectAvailableUpdates)="executeAction($event)"
                        (viewChange)="onViewChange($event)">
                      </mcs-service-os-updates-patch>
                    </mcs-grid-column>
                  </mcs-grid-row>

                  <!-- Schedule -->
                  <mcs-grid-row>
                    <mcs-grid-column>
                      <mcs-service-os-updates-schedule
                        [osUpdatesDetails]="updatesDetails"
                        [server]="server"
                        [jobsMap]="jobsMap$ | async"
                        (viewChange)="onViewChange($event)">
                      </mcs-service-os-updates-schedule>
                    </mcs-grid-column>
                  </mcs-grid-row>
                </mcs-grid>
              </mcs-data-status-success>

              <mcs-data-status-in-progress mcsDataInProgress>
                <span>{{ 'serverServices.operatingSystemUpdates.loadingContent' | translate }}</span>
              </mcs-data-status-in-progress>

              <mcs-data-status-error mcsDataError>
                <span>{{ 'serverServices.operatingSystemUpdates.errorGettingServerDetails' | translate }}</span>
              </mcs-data-status-error>
            </mcs-data-status>
          </ng-container>
        </mcs-section>
        <ng-template #osAutomationNotAvailable>
          <mcs-status-message type="info">
            {{ 'serverServices.operatingSystemUpdates.osAutomationNotAvailable' | translate }}
          </mcs-status-message>
        </ng-template>
      </mcs-presentation-panel>

      <!-- InView -->
      <ng-container *mcsAccessControl="[]; feature: 'EnableOrderingManagedServerInviewLevelRaise'">
        <mcs-service-inview
          [server]="server"
          (raiseInviewLevel)="executeAction($event)">
        </mcs-service-inview>
      </ng-container>

       <!-- Host Security -->
       <ng-container *mcsAccessControl="['HidsView', 'AvView']; feature: ['EnableAddonHidsView','EnableAddonAntiVirusView']">
         <ng-container *ngIf="serverHostSecurityDetails$ | async as serverHostSecurityDetails">
          <mcs-presentation-panel *ngIf="serverHostSecurityDetails?.hids?.provisioned || serverHostSecurityDetails?.antiVirus?.provisioned">
            <ng-container mcsPresentationPanelHeader>
              <h2>{{ 'serverServices.hostSecurity.title' | translate }}</h2>
            </ng-container>
            <mcs-section>
              <mcs-presentation-panel>
                <ng-container mcsPresentationPanelHeader>
                  <mcs-item>
                    <mcs-icon [key]="serverHostSecurityDetails.icon" size="small" mcsId="hids-status-icon"></mcs-icon>
                    <h2>{{ serverHostSecurityDetails.label }}</h2>
                  </mcs-item>
                </ng-container>
                <mcs-section>

                  <!-- Hids -->
                  <ng-container orientation="block" *mcsAccessControl="['HidsView']; feature: 'EnableAddonHidsView'">
                    <mcs-item *ngIf="serverHostSecurityDetails?.hids?.provisioned">
                      <mcs-service-hids
                        [hids]="serverHostSecurityDetails?.hids"
                        (viewChange)="onViewChange($event)">
                      </mcs-service-hids>
                    </mcs-item>
                  </ng-container>

                  <!-- Anti Virus -->
                  <ng-container orientation="block" *mcsAccessControl="['AvView']; feature: 'EnableAddonAntiVirusView'">
                    <mcs-item *ngIf="serverHostSecurityDetails?.antiVirus?.provisioned">
                      <mcs-service-anti-virus
                        [antivirus]="serverHostSecurityDetails?.antiVirus"
                        (viewChange)="onViewChange($event)">
                      </mcs-service-anti-virus>
                    </mcs-item>
                  </ng-container>
                </mcs-section>
              </mcs-presentation-panel>
            </mcs-section>
          </mcs-presentation-panel>
        </ng-container>
      </ng-container>

      <!-- VM Backup -->
      <ng-container *mcsAccessControl="[]; feature: 'EnableAddonVmBackupView'">
        <ng-container *ngIf="serverBackUpVm$ | async as vmBackup">
          <ng-container *ngIf="vmBackup.provisioned">
            <mcs-service-backup-vm
              [serverBackupVm]="vmBackup"
              (viewChange)="onViewChange($event)">
            </mcs-service-backup-vm>
          </ng-container>
        </ng-container>
      </ng-container>

      <!-- Server Backup -->
      <ng-container *mcsAccessControl="[]; feature: 'EnableAddonServerBackupView'">
        <ng-container *ngIf="serverBackUpServer$ | async as serverBackup">
          <ng-container *ngIf="serverBackup.provisioned">
            <mcs-service-backup-server
              [serverBackupServer]="serverBackup"
              (viewChange)="onViewChange($event)">
            </mcs-service-backup-server>
          </ng-container>
        </ng-container>
      </ng-container>
    </section>

    <!-- Details View Os Updates Patch -->
    <ng-container [@fadeIn] *ngSwitchCase="serverServicesViewOption.OsUpdatesPatch">
      <ng-container *mcsAccessControl="serverPermission.vmPatchManagement; feature: 'EnableServerOsUpdates'">
        <ng-container *ngIf="updatesDetails$ | async">
          <mcs-service-os-updates-patch-details
            [selectedServer]="server"
            (patchUpdates)="onPatchUpdates($event)">
            <ng-container mcsViewServicesTab *ngTemplateOutlet="servicesTabView"></ng-container>
          </mcs-service-os-updates-patch-details>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- Details View Os Updates Schedule -->
    <ng-container [@fadeIn] *ngSwitchCase="serverServicesViewOption.OsUpdatesSchedule">
      <ng-container *mcsAccessControl="serverPermission.vmPatchManagement; feature: 'EnableServerOsUpdates'">
        <ng-container *ngIf="updatesDetails$ | async">
          <mcs-server-os-updates-schedule-details
            [selectedServer]="server"
            (saveSchedule)="onSaveSchedule($event)"
            (deleteSchedule)="onDeleteSchedule($event)">
            <ng-container mcsViewServicesTab *ngTemplateOutlet="servicesTabView"></ng-container>
          </mcs-server-os-updates-schedule-details>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- Details View Anti-Virus -->
    <ng-container [@fadeIn] *ngSwitchCase="serverServicesViewOption.AntiVirus">
      <mcs-service-anti-virus-details [serverId]="server?.id">
        <ng-container mcsViewServicesTab *ngTemplateOutlet="servicesTabView"></ng-container>
      </mcs-service-anti-virus-details>
    </ng-container>

    <!-- Details View Hids -->
    <ng-container [@fadeIn] *ngSwitchCase="serverServicesViewOption.Hids">
      <mcs-service-hids-details [serverId]="server?.id">
        <ng-container mcsViewServicesTab *ngTemplateOutlet="servicesTabView"></ng-container>
      </mcs-service-hids-details>
    </ng-container>
  </ng-container>

  <!-- Go back to services tab view -->
  <ng-template #servicesTabView>
    <a mcsButton="basic" size="medium"
      mcsId="back-to-services-link"
      mcsEventTracker="os-updates-back-to-services-click"
      mcsEventCategory="server"
      mcsEventLabel="os-updates-back-to-services"
      (click)="setViewMode(serverServicesViewOption.Default)"
      [disabled]="server.isProcessing">
      <mcs-item>
        <mcs-icon [key]="chevronLeftKey" size="medium"></mcs-icon>
        <span>{{ 'serverServices.operatingSystemUpdates.label' | translate }}</span>
      </mcs-item>
    </a>
  </ng-template>
</ng-container>
