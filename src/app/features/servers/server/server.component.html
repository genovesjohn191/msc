<mcs-page>
  <!-- Page template header -->
  <ng-container *mcsPageHeader>
    <div class="horizontal-items-spacing-small" display-flex="row" align-items="center">
      <div>
        <a (click)="navigateToResource(server)">
          <h3>{{ selectedGroupName }}</h3>
        </a>
      </div>
      <div *ngIf="selectedItem">
        <mcs-icon [key]="angleDoubleRightIconKey" size="xsmall"></mcs-icon>
      </div>
      <div>
        <h3>{{ selectedServerName }}</h3>
      </div>
    </div>
  </ng-container>

  <!-- Left Panel -->
  <mcs-left-panel *mcsLeftPanelDef="textContent.leftPanelHeader">
    <!-- listing panel -->
    <mcs-left-panel-item *mcsLeftPanelItemDef>
      <div class="listing-panel-wrapper">
        <mcs-search #search></mcs-search>
        <mcs-list-panel [listSource]="serverListSource" [selectedListItem]="selectedItem">
          <ng-container mcsListPanelDef>
            <mcs-list-panel-header *mcsListPanelHeaderDef="let vdc; propertyName: 'vdcName';"
              [groupName]="vdc">
              <span>{{ vdc }}</span>
            </mcs-list-panel-header>
            <mcs-list-panel-item *mcsListPanelItemDef="let serverPanel"
              [itemId]="serverPanel.server.id" [groupName]="serverPanel.vdcName"
              [disabled]="serverDeleting(serverPanel.server)"
              (click)="onServerSelect(serverPanel.server)">
              <mcs-icon *ngIf="!serverPanel.server.isProcessing"
                size="small"
                [key]="getStateIconKey(serverPanel.server.powerState)"></mcs-icon>

              <mcs-icon *ngIf="serverPanel.server.isProcessing"
                size="small" [key]="spinnerIconKey"
                [mcsTooltip]="serverPanel.server.processingText"
                mcsTooltipPosition="right"></mcs-icon>

              <a>{{ serverPanel.server.name }}</a>
            </mcs-list-panel-item>
          </ng-container>

          <!-- List Items Status Integration -->
          <ng-container mcsListItemsStatusDef>
            <mcs-list-items-empty *mcsListItemsEmptyDef>
              <span>{{ serversTextContent.noServers }}</span>
            </mcs-list-items-empty>
            <mcs-list-items-error *mcsListItemsErrorDef>
              <div class="data-error">
                <span>{{ serversTextContent.errorMessage }}</span>
                <a (click)="retryListsource()">{{ serversTextContent.retry }}</a>.
              </div>
            </mcs-list-items-error>
          </ng-container>
        </mcs-list-panel>
      </div>
    </mcs-left-panel-item>
  </mcs-left-panel>

  <mcs-content-panel *mcsContentPanelDef>
    <div class="routing-tab-wrapper">
      <mcs-tab-group [selectedTabId]="selectedRoutingTab" (tabChanged)="onTabChanged($event)">
        <!-- Management Tab -->
        <mcs-tab [label]="textContent.management.label" id="management">
        </mcs-tab>

        <!-- Storage Tab -->
        <mcs-tab [label]="textContent.storage.label" id="storage">
        </mcs-tab>

        <!-- Backup Tab -->
        <!-- TODO: Since the backups was not yet finished,
          use the "Snapshot" on the backups tab first
          instead of textContent.backups.label
         -->
        <ng-container *mcsHasPermission="['SnapshotAccess']">
          <mcs-tab *mcsIsSelfManagedServer="server"
            label="Snapshots" id="backups">
          </mcs-tab>
        </ng-container>

        <!-- Networks Tab -->
        <mcs-tab [label]="textContent.nics.label" id="nics">
        </mcs-tab>

        <!-- Action tab -->
        <mcs-tab [canSelect]="false" customClass="right-align"
          *mcsHasPermission="['VmPowerStateEdit']">
          <ng-template mcsTabLabel>
            <mcs-server-command [server]="server"
              (onClick)="executeServerCommand(server, $event)">
            </mcs-server-command>
          </ng-template>
        </mcs-tab>
      </mcs-tab-group>

      <!-- Tab content for routing tab -->
      <div class="routing-tab-content-wrapper position-relative">
        <!-- Loader settings -->
        <div [mcsLoader]="serverSubscription"
          [mcsLoaderHideElement]="tabContent"
          [mcsLoaderText]="textContent.loading"
          mcsLoaderOrientation="top"></div>

        <router-outlet #tabContent></router-outlet>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>