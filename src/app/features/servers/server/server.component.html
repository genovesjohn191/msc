<mcs-page [header]="serverTextContent.header">
  <!-- Left Panel -->
  <mcs-left-panel *mcsLeftPanelDef>
    <!-- listing panel -->
    <mcs-left-panel-item *mcsLeftPanelItemDef [header]="serverTextContent.panel">
      <div class="listing-panel-wrapper">
        <mcs-search #search [delayInSeconds]="0"></mcs-search>
        <mcs-list-panel [listSource]="serverListSource" [selectedListItem]="selectedItem"
          [searchMode]="serverListSource?.searchMode" [mcsLoader]="serverListSource?.serverListSubscription">
          <ng-container mcsListDef>
            <mcs-list-header *mcsListHeaderDef="let vdc; propertyName: 'vdcName';"
              [groupName]="vdc">
              <span>{{ vdc }}</span>
            </mcs-list-header>
            <mcs-list-item *mcsListItemDef="let server"
              [itemId]="server.id" [groupName]="server.vdcName"
              (click)="onServerSelect(server.id)">

              <mcs-icon *ngIf="server.powerState" [key]="getStateIconKey(server.powerState)"></mcs-icon>
              <mcs-icon *ngIf="!server.powerState" [key]="spinnerIconKey"
                mcsPopover trigger="hover" maxWidth="250px" padding="narrow"
                [content]="loadingContent"></mcs-icon>
              <ng-template #loadingContent>
                <span class="loading-content-popover">
                  {{ getActiveServerTooltip(server.id) }}
                </span>
              </ng-template>

              <a>{{ server.name }}</a>
            </mcs-list-item>
          </ng-container>

          <!-- List Items Status Integration -->
          <ng-container mcsListItemsStatusDef>
            <mcs-list-items-empty *mcsListItemsEmptyDef>
              <span>{{ serversTextContent.noServers }}</span>
            </mcs-list-items-empty>
            <mcs-list-items-error *mcsListItemsErrorDef>
              <div class="data-error">
                <span>{{ serversTextContent.errorMessage }}</span>
                <a (click)="retryListsource()">{{ serversTextContent.retry }}</a>.
              </div>
            </mcs-list-items-error>
          </ng-container>
        </mcs-list-panel>
      </div>
    </mcs-left-panel-item>
  </mcs-left-panel>

  <mcs-content-panel *mcsContentPanelDef>
    <div class="content-wrapper" [mcsLoader]="serverSubscription">
      <h2 class="title">{{ server.managementName }}</h2>
      <div class="mcs-tabs">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" role="tab"
              [routerLink]="['management']" routerLinkActive="active">
                {{ serverTextContent.management.label }}</a>
          </li>
          <!-- TODO: Temporarily hidden for phase one -->
          <!-- <li *ngIf="isManaged" class="nav-item">
            <a class="nav-link" data-toggle="tab" role="tab"
              [routerLink]="['services']" routerLinkActive="active">Services</a>
          </li> -->
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" role="tab"
              [routerLink]="['storage']" routerLinkActive="active">
                {{ serverTextContent.storage.label }}</a>
          </li>
          <!-- TODO: Temporarily hidden for phase one -->
          <!-- <li class="nav-item">
            <a class="nav-link" data-toggle="tab" role="tab"
              [routerLink]="['backups']" routerLinkActive="active">Backups</a>
          </li> -->
          <li class="nav-item action-cog" *mcsHasPermission="['VmPowerStateEdit']">
            <mcs-server-command [command]="getActionStatus(server)"
              (onClick)="executeServerCommand(server, $event)"></mcs-server-command>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane active" role="tabpanel">
            <router-outlet></router-outlet>
          </div>
        </div>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>