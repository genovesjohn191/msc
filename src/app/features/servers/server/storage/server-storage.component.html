<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="storageContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div class="vertical-items-spacing-medium" #storageContent>
    <div class="grid-column">
      <h3 class="grid-content-header">{{ textContent.title }}</h3>
      <p>{{ textContent.description }}</p>
    </div>

    <div *ngIf="!expandStorage" class="vertical-items-spacing-large grid-column">
      <div>
        <div [mcsLoader]="storageDeviceSubscription">
          <p *ngIf="!hasStorageDevice">{{ textContent.noDisks }}</p>
          <table *ngIf="hasStorageDevice" class="mcs-simple-table full-width">
            <thead>
              <tr>
                <td>
                  <strong>{{ textContent.storageDevice }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.storageProfile }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.capacity }}</strong>
                </td>
                <td></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let storage of server.storageDevice">
                <td class="squishy-cell">
                  <ng-container *ngIf="activeStorageId === storage.id; else defaultStorageIcon">
                    <mcs-icon class="inline-block" [key]="spinnerIconKey" size="small"
                      [mcsTooltip]="jobSummaryInfo" mcsTooltipPosition="right"></mcs-icon>
                  </ng-container>
                  <ng-template #defaultStorageIcon>
                    <mcs-icon class="inline-block" [key]="storageIconKey" size="small"></mcs-icon>
                  </ng-template>
                  <span class="inline-block">{{ storage.name }}</span>
                </td>
                <td class="squishy-cell">
                  {{ storage.storageProfile }}
                </td>
                <td>
                  {{ appendGbUnit(convertStorageInGb(storage.sizeMB)) }}
                </td>
                <td class="action-items">
                  <span *mcsHasPermission="['VmEdit']" [hidden]="isProcessing" class="expand text-right">
                    <a [disabled]="storageScaleIsDisabled" (click)="onExpandStorage(storage)">
                      {{ textContent.expandStorageLink }}
                    </a>
                  </span>
                  <span *mcsHasPermission="['VmEdit']" [hidden]="isProcessing" class="delete text-right">
                    <a *ngIf="hasMultipleStorageDevice"
                      [disabled]="storageScaleIsDisabled"
                      (click)="deleteStorage(storage)">
                      {{ textContent.deleteStorageLink }}
                    </a>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div *mcsHasPermission="['VmEdit']">
        <div *ngIf="!hasReachedDisksLimit" class="action-box">
          <mcs-server-manage-storage *ngIf="hasStorageProfileList" #mcsStorage
            [storageProfileList]="storageProfileList" [minValueMB]="storageMinValueMB"
            [minimumMB]="0" [maximumMB]="maximumMB" [step]="sliderStep"
            (storageChanged)="onStorageChanged($event)" [disabled]="storageScaleIsDisabled">
            <!--Server manage storage contents on the left hand side (description)-->
            <div title>
              <h4>{{ textContent.addStorageHeading }}</h4>
            </div>

            <div server-storage-warning>
              <span>{{ textContent.fullStorageSpace }}</span>
            </div>
          </mcs-server-manage-storage>
          <div [ngStyle]="{'text-align': 'right'}">
            <button mcsButton id="ctaAttachServerStorage" arrow="right"
              [disabled]="attachIsDisabled"
              (click)="onClickAttach()">
              {{ textContent.attachStorage }}
            </button>
          </div>
        </div>

        <div *ngIf="hasReachedDisksLimit" class="horizontal-items-spacing-xsmall"
          display-flex="row" align-items="center" justify-content="center">
          <mcs-icon [key]="warningIconKey" size="xlarge"></mcs-icon>
          <h4>{{ textContent.reachedStorageLimit }}</h4>
        </div>
      </div>
    </div>

    <div class="grid-column" *ngIf="expandStorage">
      <mcs-server-manage-storage #mcsStorage
        [minimumMB]="selectedStorageDevice.sizeMB"
        [maximumMB]="maximumMB"
        [step]="sliderStep"
        [minValueMB]="selectedStorageDevice.sizeMB + storageMinValueMB"
        (storageChanged)="onStorageChanged($event)"
        [disabled]="storageScaleIsDisabled">
        <!--Server manage storage contents on the left hand side (description)-->
        <div title>
          <h4>{{ textContent.expandStorageHeading }}</h4>
        </div>

        <div details class="vertical-items-spacing-xsmall">
          <p><strong>Storage Device : </strong> <span>{{ selectedStorageDevice.name }}</span></p>
          <p><strong>Storage Profile : </strong> <span>{{ selectedStorageDevice.storageProfile }}</span></p>
          <p>
            <strong>Current Size : </strong>
            <span>{{ appendGbUnit(convertStorageInGb(selectedStorageDevice.sizeMB)) }}</span>
          </p>
        </div>
      </mcs-server-manage-storage>
      <div display-flex="row" align-items="center" justify-content="space-between">
        <a (click)="closeExpandStorageBox()" [ngClass]="{'disabled': isProcessing}">Cancel</a>

        <button *mcsHasPermission="['VmEdit']"
          mcsButton id="ctaUpdateServerStorage" arrow="right"
          [disabled]="expandIsDisabled"
          (click)="onClickUpdate()">
          {{ textContent.updateStorage }}
        </button>
      </div>
    </div>
  </div>
</div>