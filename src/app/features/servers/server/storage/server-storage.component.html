<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="storageContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div class="container-wrapper" #storageContent>
    <h4 class="container-header">{{ textContent.title }}</h4>
    <p>{{ textContent.description }}</p>

    <ng-container [ngSwitch]="diskMethodType">
      <div [@fadeIn] *ngSwitchCase="serverDiskMethodTypeEnum.AddDisk" class="block-items-large">
        <!-- Disks Table -->
        <mcs-data-status [dataStatusFactory]="dataStatusFactory">
          <mcs-data-status-success mcsDataSuccess>
            <table class="basic-table no-gutter">
              <thead>
                <tr>
                  <th>{{ textContent.storageDevice }}</th>
                  <th>{{ textContent.storageProfile }}</th>
                  <th>{{ textContent.capacity }}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let storage of serverDisks">
                  <td>
                    <div class="inline-items-xsmall">
                      <ng-container *ngIf="diskIsInProgress(storage); else defaultStorageIcon">
                        <mcs-icon [key]="spinnerIconKey" size="small"
                          [mcsTooltip]="jobSummaryInfo"
                          mcsTooltipPosition="right"></mcs-icon>
                      </ng-container>
                      <ng-template #defaultStorageIcon>
                        <mcs-icon [key]="storageIconKey" size="small"></mcs-icon>
                      </ng-template>
                      <span class="break-word-all">{{ storage.name }}</span>
                    </div>
                  </td>
                  <td>
                    {{ storage.storageProfile }}
                  </td>
                  <td>
                    {{ storage.sizeMB | mcsDataSize: 'MB' }}
                  </td>
                  <td>
                    <div class="inline-items-small flex-nowrap" *mcsIsSelfManagedServer="server">
                      <span *mcsAccessControl="['VmEdit']">
                        <a [disabled]="!server.executable"
                          (click)="openExpandDiskWindow(storage)"
                            mcsEventTracker="show-expand-disk"
                            mcsEventCategory="server"
                            mcsEventLabel="server-details-page">
                          {{ textContent.expandStorageLink }}
                        </a>
                      </span>
                      <span *mcsAccessControl="['VmEdit']" >
                        <a *ngIf="canDeleteDisk" [disabled]="!server.executable"
                          (click)="deleteDisk(storage)"
                          mcsEventTracker="delete-disk"
                          mcsEventCategory="server"
                          mcsEventLabel="server-details-page">
                          {{ textContent.deleteStorageLink }}
                        </a>
                      </span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </mcs-data-status-success>

          <mcs-data-status-in-progress mcsDataInProgress>
            <span>{{ textContent.loadingContent }}</span>
          </mcs-data-status-in-progress>

          <mcs-data-status-empty mcsDataEmpty>
            <span>{{ textContent.noDisks }}</span>
          </mcs-data-status-empty>

          <mcs-data-status-error mcsDataError>
            <span>{{ textContent.errorGettingDisks }}</span>
          </mcs-data-status-error>
        </mcs-data-status>

        <!-- Adding Disk -->
        <ng-container *mcsAccessControl="['VmEdit']">
          <ng-container *mcsIsSelfManagedServer="server">
            <div class="action-box" *ngIf="canAddDisk" [disabled]="!server.executable">
              <mcs-server-manage-storage *ngFor="let item of manageStorageTemplate"
                [storages]="resourceStorages"
                [minValueGB]="0"
                [(selectedStorage)]="selectedStorage"
                (dataChange)="onStorageChanged($event)">

                <ng-container mcsManageStorageHeader>
                  <h4>{{ textContent.addStorageHeading }}</h4>
                </ng-container>
                <ng-container mcsManageStorageWarning>
                  <span>{{ textContent.fullStorageSpace }}</span>
                </ng-container>
              </mcs-server-manage-storage>

              <div class="action-items">
                <button mcsButton id="ctaAttachServerStorage" arrow="right" size="small"
                  [disabled]="!addDiskEnabled" (click)="addDisk()"
                  mcsEventTracker="add-disk"
                  mcsEventCategory="server"
                  mcsEventLabel="server-details-page">
                  {{ textContent.addButton }}
                </button>
              </div>
            </div>

            <mcs-data-status-warning *ngIf="hasReachedDisksLimit">
              <span>{{ textContent.reachedStorageLimit }}</span>
            </mcs-data-status-warning>
          </ng-container>
        </ng-container>
      </div>

      <!-- Expand Disk -->
      <div [@fadeIn] *ngSwitchCase="serverDiskMethodTypeEnum.ExpandDisk">
        <div class="action-box" [disabled]="!server.executable">
          <mcs-server-manage-storage
            [storages]="resourceStorages"
            [minValueGB]="minimumGB"
            [addedValueGB]="selectedDiskSizeGB"
            [detailsTemplate]="diskDetailsTemplate"
            [(selectedStorage)]="selectedStorage"
            (dataChange)="onStorageChanged($event)">

            <ng-container mcsManageStorageHeader>
              <h4>{{ textContent.expandStorageHeading }}</h4>
            </ng-container>
          </mcs-server-manage-storage>

          <ng-template #diskDetailsTemplate>
            <mcs-list spacing="none">
              <mcs-list-item>
                <strong>{{ textContent.storageDevice }}:</strong>
                <span>{{ selectedDisk.name }}</span>
              </mcs-list-item>
              <mcs-list-item>
                <strong>{{ textContent.storageProfile }}:</strong>
                <span>{{ selectedDisk.storageProfile }}</span>
              </mcs-list-item>
              <mcs-list-item>
                <strong>{{ textContent.capacity }}:</strong>
                <span>{{ selectedDisk.sizeMB | mcsDataSize: 'MB' }}</span>
              </mcs-list-item>
            </mcs-list>
          </ng-template>

          <div class="action-items">
            <a (click)="closeExpandDiskWindow()"
              mcsEventTracker="expand-disk-close"
              mcsEventCategory="server"
              mcsEventLabel="server-details-page">{{ textContent.cancelButton }}</a>
            <button mcsButton id="ctaUpdateServerStorage" arrow="right" size="small"
              [disabled]="!expandDiskEnabled" (click)="expandDisk()"
              mcsEventTracker="expand-disk"
              mcsEventCategory="server"
              mcsEventLabel="server-details-page">
              {{ textContent.updateButton }}
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>