<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="storageContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div class="container-wrapper" #storageContent>
    <h3 class="container-header">{{ textContent.title }}</h3>
    <p>{{ textContent.description }}</p>

    <div *ngIf="!expandStorage" class="vertical-items-spacing-large">
      <!-- Disks -->
      <mcs-data-status [dataStatusFactory]="dataStatusFactory">
        <mcs-data-status-success mcsDataSuccess>
          <table class="mcs-simple-table full-width">
            <thead>
              <tr>
                <td>
                  <strong>{{ textContent.storageDevice }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.storageProfile }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.capacity }}</strong>
                </td>
                <td></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let storage of server.storageDevice">
                <td class="squishy-cell">
                  <ng-container *ngIf="storage.isProcessing; else defaultStorageIcon">
                    <mcs-icon class="inline-block" [key]="spinnerIconKey" size="small"
                      [mcsTooltip]="jobSummaryInfo" mcsTooltipPosition="right"></mcs-icon>
                  </ng-container>
                  <ng-template #defaultStorageIcon>
                    <mcs-icon class="inline-block" [key]="storageIconKey" size="small"></mcs-icon>
                  </ng-template>
                  <span class="inline-block">{{ storage.name }}</span>
                </td>
                <td class="squishy-cell">
                  {{ storage.storageProfile }}
                </td>
                <td>
                  {{ appendUnitGB(convertDiskToGB(storage.sizeMB)) }}
                </td>
                <td class="action-items">
                  <span *mcsHasPermission="['VmEdit']" class="expand text-right">
                    <a [disabled]="storageExpandLinkIsDisabled" (click)="showExpandStorageBox(storage)">
                      {{ textContent.expandStorageLink }}
                    </a>
                  </span>
                  <span *mcsHasPermission="['VmEdit']" class="delete text-right">
                    <a *ngIf="hasMultipleStorageDevice"
                      [disabled]="storageScaleIsDisabled"
                      (click)="onDeleteStorage(storage)">
                      {{ textContent.deleteStorageLink }}
                    </a>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </mcs-data-status-success>

        <mcs-data-status-in-progress mcsDataInProgress>
          <span>{{ textContent.loadingContent }}</span>
        </mcs-data-status-in-progress>

        <mcs-data-status-empty mcsDataEmpty>
          <span>{{ textContent.noDisks }}</span>
        </mcs-data-status-empty>

        <mcs-data-status-error mcsDataError>
          <span>{{ textContent.errorGettingDisks }}</span>
        </mcs-data-status-error>
      </mcs-data-status>

      <div *mcsHasPermission="['VmEdit']">
        <div *ngIf="!hasReachedDisksLimit" class="action-box">
          <mcs-server-manage-storage *ngIf="hasStorageProfileList" #mcsStorage
            [storageProfileList]="storageProfileList" [minValueMB]="storageMinValueMB"
            [minimumMB]="0" [maximumMB]="maximumMB" [step]="sliderStep"
            (storageChanged)="onStorageChanged($event)" [disabled]="storageScaleIsDisabled">
            <!--Server manage storage contents on the left hand side (description)-->
            <div mcsStorageTitle>
              <h4>{{ textContent.addStorageHeading }}</h4>
            </div>

            <div mcsStorageWarning>
              <span>{{ textContent.fullStorageSpace }}</span>
            </div>
          </mcs-server-manage-storage>
          <div [ngStyle]="{'text-align': 'right'}">
            <button mcsButton id="ctaAttachServerStorage" arrow="right"
              [disabled]="attachIsDisabled"
              (click)="onClickAttach()">
              {{ textContent.attachStorage }}
            </button>
          </div>
        </div>

        <div *ngIf="hasReachedDisksLimit" class="horizontal-items-spacing-xsmall"
          display-flex="row" align-items="center" justify-content="center">
          <mcs-icon [key]="warningIconKey" size="xlarge"></mcs-icon>
          <h4>{{ textContent.reachedStorageLimit }}</h4>
        </div>
      </div>
    </div>

    <div class="grid-column" *ngIf="expandStorage">
      <mcs-server-manage-storage #mcsStorage
        [minimumMB]="selectedStorageDevice.sizeMB"
        [maximumMB]="maximumMB"
        [step]="sliderStep"
        [minValueMB]="selectedStorageDevice.sizeMB + storageMinValueMB"
        (storageChanged)="onStorageChanged($event)"
        [disabled]="storageScaleIsDisabled">
        <!--Server manage storage contents on the left hand side (description)-->
        <div mcsStorageTitle>
          <h4>{{ textContent.expandStorageHeading }}</h4>
        </div>

        <div mcsStorageDetails class="vertical-items-spacing-xsmall">
          <p><strong>Storage Device : </strong> <span>{{ selectedStorageDevice.name }}</span></p>
          <p><strong>Storage Profile : </strong> <span>{{ selectedStorageDevice.storageProfile }}</span></p>
          <p>
            <strong>Current Size : </strong>
            <span>{{ appendUnitGB(convertDiskToGB(selectedStorageDevice.sizeMB)) }}</span>
          </p>
        </div>
      </mcs-server-manage-storage>
      <div display-flex="row" align-items="center" justify-content="space-between">
        <a (click)="closeExpandStorageBox()" [ngClass]="{'disabled': isProcessing}">Cancel</a>

        <button *mcsHasPermission="['VmEdit']"
          mcsButton id="ctaUpdateServerStorage" arrow="right"
          [disabled]="attachIsDisabled"
          (click)="onExpandStorage()">
          {{ textContent.updateStorage }}
        </button>
      </div>
    </div>
  </div>
</div>