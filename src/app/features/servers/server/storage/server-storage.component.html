<div class="limited-view">
  <div class="vertical-items-spacing-medium" [mcsLoader]="serverResourceSubscription">
    <h3 class="heading">{{ serverStorageText.title }}</h3>

    <p>{{ serverStorageText.description }}</p>

    <div *ngIf="!expandStorage" class="vertical-items-spacing-large">
      <div [ngStyle]="{'position': 'relative'}">
        <div [mcsLoader]="storageDeviceSubscription">
          <p *ngIf="!hasStorageDevice">{{ serverStorageText.noDisks }}</p>
          <table *ngIf="hasStorageDevice" class="mcs-simple-table full-width">
            <thead>
              <tr>
                <td>
                  <strong>{{ serverStorageText.storageDevice }}</strong>
                </td>
                <td>
                  <strong>{{ serverStorageText.storageProfile }}</strong>
                </td>
                <td>
                  <strong>{{ serverStorageText.capacity }}</strong>
                </td>
                <td></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let storage of storageDevices">
                <td class="squishy-cell">
                  <mcs-icon *ngIf="!isActiveStorage(storage.id)"
                    [key]="storageIconKey" size="small" class="inline-block"></mcs-icon>
                  <mcs-icon *ngIf="isActiveStorage(storage.id)" [key]="spinnerIconKey"
                    size="small" [mcsTooltip]="getStorageSummaryInformation(storage.id)"
                    mcsTooltipPosition="right" class="inline-block"></mcs-icon>
                  <span class="inline-block">{{ storage.name }}</span>
                </td>
                <td class="squishy-cell">
                  {{ storage.storageProfile }}
                </td>
                <td>
                  {{ appendGbUnit(convertStorageInGb(storage.sizeMB)) }}
                </td>
                <td class="action-items">
                  <span *mcsHasPermission="['VmEdit']" [hidden]="isProcessing" class="expand text-right">
                    <a [disabled]="storageScaleIsDisabled" (click)="onExpandStorage(storage)">
                      {{ serverStorageText.expandStorageLink }}
                    </a>
                  </span>
                  <span *mcsHasPermission="['VmEdit']" [hidden]="isProcessing" class="delete text-right">
                    <a *ngIf="hasMultipleStorageDevice"
                      [disabled]="storageScaleIsDisabled"
                      (click)="deleteStorage(storage)">
                      {{ serverStorageText.deleteStorageLink }}
                    </a>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div *mcsHasPermission="['VmEdit']">
        <div *ngIf="!hasReachedDisksLimit" class="action-box">
          <mcs-server-manage-storage *ngIf="hasStorageProfileList" #mcsStorage
            [storageProfileList]="storageProfileList"
            [memoryMB]="memoryMB"
            [availableMemoryMB]="availableMemoryMB"
            [minimumMB]="minimumMB"
            [storageSliderValues]="newStorageSliderValues"
            (storageChanged)="onStorageChanged($event)"
            [disabled]="storageScaleIsDisabled">
            <!--Server manage storage contents on the left hand side (description)-->
            <div title>
              <h4>{{ serverStorageText.addStorageHeading }}</h4>
            </div>
          </mcs-server-manage-storage>
          <div [ngStyle]="{'text-align': 'right'}">
            <button mcsButton id="ctaAttachServerStorage" arrow="right"
              [disabled]="!isValidStorageValues || !hasAvailableStorageSpace"
              (click)="onClickAttach()">
              {{ serverStorageText.attachStorage }}
            </button>
          </div>
        </div>

        <div *ngIf="hasReachedDisksLimit" class="horizontal-items-spacing-xsmall"
          display-flex="row" align-items="center" justify-content="center">
          <mcs-icon [key]="warningIconKey" size="xlarge"></mcs-icon>
          <h4>{{ serverStorageText.reachedStorageLimit }}</h4>
        </div>
      </div>
    </div>

    <div *ngIf="expandStorage">
      <mcs-server-manage-storage #mcsStorage
        [memoryMB]="selectedStorageDevice.sizeMB"
        [availableMemoryMB]="getStorageAvailableMemory(selectedStorageDevice.storageProfile)"
        [minimumMB]="selectedStorageDevice.sizeMB + minimumMB"
        [storageSliderValues]="selectedStorageSliderValues"
        (storageChanged)="onStorageChanged($event)"
        [disabled]="storageScaleIsDisabled">
        <!--Server manage storage contents on the left hand side (description)-->
        <div title>
          <h4>{{ serverStorageText.expandStorageHeading }}</h4>
        </div>

        <div details class="vertical-items-spacing-xsmall">
          <p><strong>Storage Device : </strong> <span>{{ selectedStorageDevice.name}}</span></p>
          <p><strong>Storage Profile : </strong> <span>{{ selectedStorageDevice.storageProfile}}</span></p>
          <p>
            <strong>Current Size : </strong>
            <span>{{ appendGbUnit(convertStorageInGb(selectedStorageDevice.sizeMB)) }}</span>
          </p>
        </div>
      </mcs-server-manage-storage>
      <div display-flex="row" align-items="center" justify-content="space-between">
        <a (click)="closeExpandStorageBox()" [ngClass]="{'disabled': isProcessing}">Cancel</a>

        <button *mcsHasPermission="['VmEdit']"
          mcsButton id="ctaUpdateServerStorage" arrow="right"
          [disabled]="!isValidStorageValues || expandingStorage"
          (click)="onClickUpdate()">
          {{ serverStorageText.updateStorage }}
        </button>
      </div>
    </div>
  </div>
</div>