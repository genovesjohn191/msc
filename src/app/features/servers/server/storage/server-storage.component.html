<div class="limited-view">
  <!-- Loader settings -->
  <div [mcsLoader]="serverResourceSubscription"
    [mcsLoaderHideElement]="storageContent"
    [mcsLoaderText]="textContent.loading"
    mcsLoaderOrientation="top"></div>

  <div class="container-wrapper" #storageContent>
    <h3 class="container-header">{{ textContent.title }}</h3>
    <p>{{ textContent.description }}</p>

    <div *ngIf="!expandStorage" class="vertical-items-spacing-large">
      <!-- Disks -->
      <mcs-data-status [dataStatusFactory]="dataStatusFactory">
        <mcs-data-status-success mcsDataSuccess>
          <table class="mcs-simple-table full-width">
            <thead>
              <tr>
                <td>
                  <strong>{{ textContent.storageDevice }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.storageProfile }}</strong>
                </td>
                <td>
                  <strong>{{ textContent.capacity }}</strong>
                </td>
                <td></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let storage of serverDisks">
                <td class="squishy-cell">
                  <ng-container *ngIf="storage.isProcessing; else defaultStorageIcon">
                    <mcs-icon class="inline-block" [key]="spinnerIconKey" size="small"
                      [mcsTooltip]="jobSummaryInfo" mcsTooltipPosition="right"></mcs-icon>
                  </ng-container>
                  <ng-template #defaultStorageIcon>
                    <mcs-icon class="inline-block" [key]="storageIconKey" size="small"></mcs-icon>
                  </ng-template>
                  <span class="inline-block">{{ storage.name }}</span>
                </td>
                <td class="squishy-cell">
                  {{ storage.storageProfile }}
                </td>
                <td>
                  {{ appendUnitGB(convertDiskToGB(storage.sizeMB)) }}
                </td>
                <td class="action-items">
                  <ng-container *mcsIsSelfManagedServer="server">
                    <ng-container *mcsHasPermission="['VmEdit']">
                      <span class="expand text-right">
                        <a [disabled]="expandDiskIsDisabled(storage)"
                          (click)="showExpandStorageBox(storage)">
                          {{ textContent.expandStorageLink }}
                        </a>
                      </span>
                    </ng-container>

                    <ng-container *mcsHasPermission="['VmEdit']">
                      <span class="delete text-right">
                        <a *ngIf="hasMultipleStorageDevice"
                          [disabled]="!server.executable"
                          (click)="onDeleteStorage(storage)">
                          {{ textContent.deleteStorageLink }}
                        </a>
                      </span>
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
            </tbody>
          </table>
        </mcs-data-status-success>

        <mcs-data-status-in-progress mcsDataInProgress>
          <span>{{ textContent.loadingContent }}</span>
        </mcs-data-status-in-progress>

        <mcs-data-status-empty mcsDataEmpty>
          <span>{{ textContent.noDisks }}</span>
        </mcs-data-status-empty>

        <mcs-data-status-error mcsDataError>
          <span>{{ textContent.errorGettingDisks }}</span>
        </mcs-data-status-error>
      </mcs-data-status>

      <ng-container *mcsHasPermission="['VmEdit']">
        <ng-container *mcsIsSelfManagedServer="server">
            <div *ngIf="!hasReachedDisksLimit" class="action-box">
              <mcs-server-manage-storage *ngIf="hasStorageProfileList" #mcsStorage
                [storageProfileList]="storageProfileList" [minValueMB]="storageMinValueMB"
                [minimumMB]="0" [maximumMB]="maximumMB" [step]="sliderStep"
                (storageChanged)="onStorageChanged($event)" [disabled]="!server.executable">
                <!--Server manage storage contents on the left hand side (description)-->
                <div mcsStorageTitle>
                  <h4>{{ textContent.addStorageHeading }}</h4>
                </div>

                <div mcsStorageWarning>
                  <span>{{ textContent.fullStorageSpace }}</span>
                </div>
              </mcs-server-manage-storage>
              <div [ngStyle]="{'text-align': 'right'}">
                <button mcsButton id="ctaAttachServerStorage" arrow="right"
                  [disabled]="attachStorageIsDisabled" (click)="onClickAttach()">
                  {{ textContent.attachStorage }}
                </button>
              </div>
            </div>

            <div *ngIf="hasReachedDisksLimit" class="horizontal-items-spacing-xsmall"
              display-flex="row" align-items="center" justify-content="center">
              <mcs-icon [key]="warningIconKey" size="xlarge"></mcs-icon>
              <h4>{{ textContent.reachedStorageLimit }}</h4>
            </div>
        </ng-container>
      </ng-container>
    </div>

    <ng-container *mcsHasPermission="['VmEdit']">
      <ng-container *mcsIsSelfManagedServer="server">
        <div class="grid-column" *ngIf="expandStorage && hasDiskStorageProfile">
          <mcs-server-manage-storage #mcsStorage
            [minimumMB]="selectedStorageDevice.sizeMB"
            [maximumMB]="maximumMB"
            [step]="sliderStep"
            [minValueMB]="selectedStorageDevice.sizeMB + storageMinValueMB"
            (storageChanged)="onStorageChanged($event)">
            <!--Server manage storage contents on the left hand side (description)-->
            <div mcsStorageTitle>
              <h4>{{ textContent.expandStorageHeading }}</h4>
            </div>

            <div mcsStorageDetails class="vertical-items-spacing-xsmall">
              <p>
                <strong>{{ textContent.storageDevice }}:</strong>
                <span>{{ selectedStorageDevice.name }}</span>
              </p>
              <p>
                <strong>{{ textContent.storageProfile }}:</strong>
                <span>{{ selectedStorageDevice.storageProfile }}</span>
              </p>
              <p>
                <strong>{{ textContent.capacity }}:</strong>
                <span>{{ appendUnitGB(convertDiskToGB(selectedStorageDevice.sizeMB)) }}</span>
              </p>
            </div>
          </mcs-server-manage-storage>
          <div display-flex="row" align-items="center" justify-content="space-between">
            <a (click)="closeExpandStorageBox()">Cancel</a>

            <button mcsButton id="ctaUpdateServerStorage" arrow="right"
              [disabled]="attachStorageIsDisabled" (click)="onExpandStorage()">
              {{ textContent.updateStorage }}
            </button>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>