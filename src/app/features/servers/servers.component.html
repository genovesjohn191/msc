<!-- Table with filtering and pagination -->
<div class="servers-table-wrapper">
  <!-- Search -->
  <div class="search-wrapper">
    <mcs-search #search class="search"></mcs-search>

    <mcs-filter-selector class="hidden-small" [key]="columnSettingsKey"
      (onGetFilters)="updateColumnSettings($event)"></mcs-filter-selector>

    <mcs-button (onClick)="onClickNewServerButton($event)" size="small">
      {{ textContent.newServer }}
    </mcs-button>

    <span class="record-count">{{ totalRecordCount }} {{ textContent.header }}</span>
  </div>

  <!-- Table -->
  <mcs-table [dataSource]="dataSource">
    <!-- Name Column -->
    <ng-container mcsColumnDef="name">
      <mcs-header-cell *mcsHeaderCellDef>
        {{ columnSettings.name.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row">
        <ng-template #loadingContent>
          <span class="loading-content-popover">
            {{ getActiveServerTooltip(row.id) }}
          </span>
        </ng-template>

        <div class="server-name">
          <div *ngIf="getServerPowerstate(row)">
            <mcs-icon [key]="getStateIconKey(row.powerState)"
              size="medium"></mcs-icon>
          </div>
          <div *ngIf="!getServerPowerstate(row)" class="power-state-spinner">
            <mcs-icon [key]="spinnerIconKey" size="medium"
              mcsPopover trigger="hover" maxWidth="250px" padding="none"
              [content]="loadingContent"></mcs-icon>
          </div>
          <a [routerLink]="['/servers', row.id]">{{ row.managementName }}</a>
        </div>
      </mcs-data-cell>
    </ng-container>

    <!-- Type Column -->
    <ng-container mcsColumnDef="type">
      <mcs-header-cell *mcsHeaderCellDef class="hidden-xsmall">
        {{ columnSettings.type.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-xsmall">
        {{ getServiceTypeText(row.serviceType) }}
      </mcs-data-cell>
    </ng-container>

    <!-- Catalog Column -->
    <ng-container mcsColumnDef="catalog">
      <mcs-header-cell *mcsHeaderCellDef  class="hidden-xsmall">
        {{ columnSettings.catalog.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-xsmall">
        {{ row.guestOs }}
      </mcs-data-cell>
    </ng-container>

    <!-- Private IP Column -->
    <ng-container mcsColumnDef="privateIp">
      <mcs-header-cell *mcsHeaderCellDef class="hidden-small">
        {{ columnSettings.privateIp.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-small">
        {{ row.managementIpAddress }}
      </mcs-data-cell>
    </ng-container>

    <!-- Zone Column -->
    <ng-container mcsColumnDef="zone">
      <mcs-header-cell *mcsHeaderCellDef class="hidden-small">
        {{ columnSettings.zone.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-small">
        {{ row.availabilityZone }}
      </mcs-data-cell>
    </ng-container>

    <!-- Service ID Column -->
    <ng-container mcsColumnDef="serviceId">
      <mcs-header-cell *mcsHeaderCellDef class="hidden-small">
        {{ columnSettings.serviceId.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-small">
        {{ row.serviceId }}
      </mcs-data-cell>
    </ng-container>

    <!-- VApp Column -->
    <ng-container mcsColumnDef="vApp">
      <mcs-header-cell *mcsHeaderCellDef class="hidden-small">
        {{ columnSettings.vApp.text }}
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="hidden-small">
        {{ row.vAppName }}
      </mcs-data-cell>
    </ng-container>

    <!-- Action Column TODO: add restriction here VmPowerStateEdit -->
    <ng-container mcsColumnDef="action">
      <mcs-header-cell *mcsHeaderCellDef>
        <!-- {{ columnSettings.action.text }} -->
      </mcs-header-cell>
      <mcs-data-cell *mcsDataCellDef="let row" class="text-center">
        <mcs-server-command [command]="getActionStatus(row)"
          (onClick)="executeServerCommand(row, $event)"></mcs-server-command>
      </mcs-data-cell>
    </ng-container>

    <!-- Header and Data row -->
    <mcs-header-row *mcsHeaderRowDef="dataColumns"></mcs-header-row>
    <mcs-data-row *mcsDataRowDef="let row; columns: dataColumns;"></mcs-data-row>
  </mcs-table>

  <div class="message-wrapper" *ngIf="displayErrorMessage">
    <!-- Message when error encountered -->
    <div *ngIf="successfullyObtained === false">
      <span>{{ textContent.errorMessage }}</span>
      <a (click)="retryDatasource()">Try again shortly</a>.
    </div>

    <!-- Message when no servers found -->
    <div *ngIf="noServersFound">
      <span>{{ textContent.noServers }}</span>
    </div>
  </div>

  <!-- Paginator -->
  <mcs-paginator #paginator
    [totalCount]="totalRecordCount"
    [pageIndex]="0"
    [pageSize]="25">
  </mcs-paginator>
</div>