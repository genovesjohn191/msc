<mcs-page [header]="selectedFirewall?.managementName">
  <!-- Left Panel -->
  <mcs-left-panel *mcsLeftPanelDef="firewallTextContent.leftPanelHeader">
    <!-- listing panel -->
    <mcs-left-panel-item *mcsLeftPanelItemDef>
      <div class="listing-panel-wrapper">
        <mcs-search #search></mcs-search>

        <mcs-data-status [dataStatusFactory]="listStatusFactory">
          <mcs-data-status-success mcsDataSuccess>
            <mcs-list-panel>
              <!-- With ha group (with more than 1 group) -->
              <div *ngFor="let iterator of (firewallsMap | mcsMapIterable) |
                mcsSortArray: firewallsListSource?.firewallGroupSortMethod" class="position-relative">
                <mcs-option-group *ngIf="iterator.value?.length > 1"
                  [label]="getFirewallGroupName(iterator.key)">
                  <mcs-option *ngFor="let firewall of (iterator.value | mcsSortArray: firewallsListSource?.firewallSortMethod)"
                    [value]="firewall"
                    [selected]="selectedFirewall?.id === firewall.id"
                    (click)="onFirewallSelect(firewall)"
                    mcsEventTracker="select-firewall"
                    mcsEventCategory="firewall"
                    mcsEventLabel="firewall-list-panel">

                    <div class="inline-items-xsmall">
                      <mcs-icon size="small" [key]="firewall?.connectionStatusIconKey"></mcs-icon>
                      <span>{{ firewall.managementName }}</span>
                      <span read-only>{{ firewall.haRole }}</span>
                    </div>
                  </mcs-option>
                </mcs-option-group>
              </div>

              <!-- Without ha group -->
              <div *ngFor="let iterator of (firewallsMap | mcsMapIterable) |
                mcsSortArray: firewallsListSource?.firewallGroupSortMethod" class="position-relative">
                <ng-container *ngIf="iterator.value?.length === 1">
                  <mcs-option *ngFor="let firewall of (iterator.value | mcsSortArray: firewallsListSource?.firewallSortMethod)"
                    [value]="firewall"
                    [selected]="selectedFirewall?.id === firewall.id"
                    (click)="onFirewallSelect(firewall)"
                    mcsEventTracker="select-firewall"
                    mcsEventCategory="firewall"
                    mcsEventLabel="firewall-list-panel">

                    <div class="inline-items-xsmall">
                      <mcs-icon size="small" [key]="firewall?.connectionStatusIconKey"></mcs-icon>
                      <span>{{ firewall.managementName }}</span>
                    </div>
                  </mcs-option>
                </ng-container>
              </div>
            </mcs-list-panel>
          </mcs-data-status-success>

          <mcs-data-status-in-progress mcsDataInProgress>
            <span>{{ firewallsTextContent.loading }}</span>
          </mcs-data-status-in-progress>

          <mcs-data-status-empty mcsDataEmpty>
            <span>{{ firewallsTextContent.noFirewalls }}</span>
          </mcs-data-status-empty>

          <mcs-data-status-error mcsDataError>
            <span>{{ firewallsTextContent.errorMessage }}</span>
          </mcs-data-status-error>
        </mcs-data-status>
      </div>
    </mcs-left-panel-item>
  </mcs-left-panel>

  <mcs-content-panel *mcsContentPanelDef>
    <div class="routing-tab-wrapper">
      <mcs-tab-group [selectedTabId]="selectedRoutingTab" (tabChanged)="onTabChanged($event)">
        <!-- Overview Tab -->
        <mcs-tab [label]="firewallTextContent.overview.label" id="overview">
        </mcs-tab>

        <!-- Policies Tab -->
        <ng-container *ngIf="selectedFirewall?.serialNumber">
          <mcs-tab [label]="firewallTextContent.policies.label" id="policies">
          </mcs-tab>
        </ng-container>

        <!-- Action tab -->
        <mcs-tab [canSelect]="false" customClass="right-align">
          <ng-template mcsTabLabel>
            <mcs-icon class="action" [key]="cogIconKey" size="medium"
              mcsPopover placement="bottom" orientation="left" theme="light"
              padding="none" [content]="actionContent" cursor="pointer">
            </mcs-icon>
            <ng-template #actionContent>
              <div class="cog-container">
                <a [href]="selectedFirewall.url" target="_blank">View in Portal</a>
              </div>
            </ng-template>
          </ng-template>
        </mcs-tab>
      </mcs-tab-group>

      <!-- Tab content for routing tab -->
      <div class="routing-tab-content-wrapper">
        <mcs-loader [subscriptions]="firewallSubscription"
          [loadingText]="firewallTextContent.loading"
          loadingPlacement="top" class="limited-view">
          <div><router-outlet></router-outlet></div>
        </mcs-loader>
      </div>
    </div>
  </mcs-content-panel>
</mcs-page>